<!DOCTYPE html>
<html>
<head>
    <title>ç®¡ç†å‘˜æƒé™è¯Šæ–­å·¥å…·</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>ğŸ” ç®¡ç†å‘˜æƒé™è¯Šæ–­å·¥å…·</h1>
    
    <div id="results"></div>
    
    <h2>æ‰‹åŠ¨æ“ä½œ</h2>
    <button onclick="checkUserStatus()">1. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€</button>
    <button onclick="navigateToTopicManagement()">2. å¯¼èˆªåˆ°ä¸“é¢˜ç®¡ç†</button>
    <button onclick="checkRoutes()">3. æ£€æŸ¥è·¯ç”±çŠ¶æ€</button>
    <button onclick="clearCacheAndReload()">4. æ¸…é™¤ç¼“å­˜å¹¶é‡è½½</button>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
            console.log(message);
        }
        
        function checkUserStatus() {
            try {
                log('=== æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ ===');
                const app = document.querySelector('#app').__vue__;
                const store = app.$store;
                
                log('Store çŠ¶æ€:');
                log('- user: ' + JSON.stringify(store.getters.user));
                log('- è®¤è¯çŠ¶æ€: ' + store.getters.isAuthenticated);
                log('- ç®¡ç†å‘˜æƒé™: ' + store.getters.isAdminRole);
                log('- è¶…çº§ç®¡ç†å‘˜: ' + store.getters.isSuperAdmin);
                
                log('å½“å‰è·¯ç”±: ' + window.location.href);
                log('Hash: ' + window.location.hash);
                
                return store.getters.user;
            } catch (e) {
                log('é”™è¯¯: ' + e.message);
                return null;
            }
        }
        
        function navigateToTopicManagement() {
            log('=== å¯¼èˆªåˆ°ä¸“é¢˜ç®¡ç† ===');
            
            // æ–¹æ³•1: ä½¿ç”¨ Vue Router
            try {
                const app = document.querySelector('#app').__vue__;
                app.$router.push({name: 'topic-management'});
                log('âœ… ä½¿ç”¨ Vue Router å¯¼èˆª');
            } catch (e) {
                log('Vue Router å¯¼èˆªå¤±è´¥: ' + e.message);
                
                // æ–¹æ³•2: ç›´æ¥ä¿®æ”¹ hash
                window.location.hash = '#/topic/management';
                log('âœ… ä½¿ç”¨ hash å¯¼èˆª');
            }
            
            setTimeout(() => {
                log('å¯¼èˆªåçš„ URL: ' + window.location.href);
            }, 1000);
        }
        
        function checkRoutes() {
            log('=== æ£€æŸ¥è·¯ç”±çŠ¶æ€ ===');
            
            try {
                const app = document.querySelector('#app').__vue__;
                const router = app.$router;
                
                log('å½“å‰è·¯ç”±å¯¹è±¡: ' + JSON.stringify(router.currentRoute));
                log('è·¯ç”±å†å²: ' + JSON.stringify(router.history.current));
                
                // æ£€æŸ¥ä¸“é¢˜ç®¡ç†è·¯ç”±æ˜¯å¦å­˜åœ¨
                const routes = router.options.routes;
                log('å¯ç”¨è·¯ç”±æ•°é‡: ' + routes.length);
                
                // æŸ¥æ‰¾ä¸“é¢˜ç®¡ç†ç›¸å…³è·¯ç”±
                routes.forEach(route => {
                    if (route.children) {
                        route.children.forEach(child => {
                            if (child.path.includes('topic') || child.name && child.name.includes('topic')) {
                                log('æ‰¾åˆ°ä¸“é¢˜ç›¸å…³è·¯ç”±: ' + child.name + ' -> ' + child.path);
                            }
                        });
                    }
                });
                
            } catch (e) {
                log('æ£€æŸ¥è·¯ç”±å¤±è´¥: ' + e.message);
            }
        }
        
        function clearCacheAndReload() {
            log('=== æ¸…é™¤ç¼“å­˜å¹¶é‡è½½ ===');
            
            // æ¸…é™¤ localStorage
            if (typeof Storage !== 'undefined') {
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    localStorage.removeItem(key);
                    log('æ¸…é™¤ localStorage: ' + key);
                });
            }
            
            // æ¸…é™¤ sessionStorage
            if (typeof Storage !== 'undefined') {
                const keys = Object.keys(sessionStorage);
                keys.forEach(key => {
                    sessionStorage.removeItem(key);
                    log('æ¸…é™¤ sessionStorage: ' + key);
                });
            }
            
            log('3ç§’åé‡æ–°åŠ è½½é¡µé¢...');
            setTimeout(() => {
                window.location.reload(true);
            }, 3000);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('=== é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨è¯Šæ–­ ===');
                checkUserStatus();
                checkRoutes();
            }, 2000);
        });
        
        // ç›‘å¬è·¯ç”±å˜åŒ–
        window.addEventListener('hashchange', function() {
            log('Hash å˜åŒ–: ' + window.location.hash);
        });
        
        // ç›‘å¬ Vue è·¯ç”±å˜åŒ–
        setTimeout(() => {
            try {
                const app = document.querySelector('#app').__vue__;
                app.$router.beforeEach((to, from, next) => {
                    log('Vue è·¯ç”±å˜åŒ–: ' + from.path + ' -> ' + to.path);
                    next();
                });
            } catch (e) {
                console.log('æ— æ³•ç›‘å¬ Vue è·¯ç”±å˜åŒ–:', e);
            }
        }, 3000);
    </script>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; }
        #results { 
            background: #f5f5f5; 
            padding: 10px; 
            margin: 20px 0; 
            max-height: 400px; 
            overflow-y: auto;
            border: 1px solid #ddd;
        }
    </style>
</body>
</html>
