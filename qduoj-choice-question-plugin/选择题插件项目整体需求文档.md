我帮您完善这份需求文档，加入错题本、分类管理、标签管理等功能：

## 📋 项目整体需求文档（完整版）

### 一、项目总体目标

**在青岛OJ系统基础上开发一个选择题功能模块，要求：**
1. 完全融入现有OJ的UI设计风格，看起来像原生功能
2. 支持单选题和多选题
3. 具备完整的分类管理、标签管理、错题本功能
4. 最终可打包成插件，其他用户能一键安装部署
5. 保持与原OJ系统的用户体系、权限体系、数据统计完全集成

### 二、核心功能需求

```markdown
## 选择题模块功能清单

### 1. 题目管理
- 创建/编辑/删除选择题（单选/多选）
- 题目难度设置（Easy/Medium/Hard）
- 批量导入导出（Excel/CSV格式）
- 题目审核和发布流程
- 题目版本管理（修改历史）

### 2. 分类管理（支持多级分类）
- 创建/编辑/删除分类
- 支持无限级分类树结构
- 分类排序和移动
- 分类下题目数量统计
- 批量移动题目到其他分类

### 3. 标签管理
- 创建/编辑/删除标签
- 标签颜色设置
- 热门标签统计
- 题目批量添加/移除标签
- 标签云展示

### 4. 答题功能
- 题目列表展示（分页、筛选、搜索）
- 按分类/标签/难度筛选
- 答题界面（显示题目、选项、提交答案）
- 实时判题和反馈
- 答题记录和历史查看
- 题目收藏功能

### 5. 错题本功能
- 自动记录错题
- 错题分类查看（按分类/标签/时间）
- 重做错题功能
- 错题笔记添加
- 错题导出PDF
- 错题重做统计（掌握程度）
- 智能错题推荐（相似题目）

### 6. 统计分析
- 个人答题统计（正确率、答题数、积分）
- 按分类/标签的正确率分析
- 答题趋势图表
- 薄弱知识点分析
- 题目统计（通过率、提交次数）
- 排行榜功能（总榜/分类榜/周榜/月榜）

### 7. 管理后台
- 分类树形管理界面
- 标签管理界面
- 题目批量操作
- 用户答题记录管理
- 数据统计报表
- 错题本使用情况统计
```

### 三、给Trae的整体任务说明

```markdown
# 任务概述
我已经成功部署了青岛OJ的前后端源码，现在需要在此基础上开发一个功能完整的选择题模块。

## 当前环境
- 青岛OJ后端已部署（Django框架）
- 青岛OJ前端已部署（Vue框架）
- 系统正常运行，可以正常访问

## 开发要求
1. 基于现有代码结构开发，不破坏原有功能
2. 完全复用OJ现有的UI组件和样式
3. 使用OJ现有的用户认证和权限系统
4. 代码结构要支持后期插件化改造
5. 支持多级分类和灵活的标签系统
6. 实现完整的错题本功能

## 技术约束
- 必须使用Django作为后端框架
- 必须使用Vue作为前端框架
- 必须复用OJ现有的数据库结构（扩展而非修改）
- 必须遵循OJ现有的API规范
- 使用Django MPTT实现多级分类
- 使用Django-taggit或自建标签系统
```

### 四、任务拆解步骤

## 🔨 第一阶段：基础开发（核心功能）

### Step 1: 后端基础搭建
```markdown
任务1.1：创建Django App
- 在OJ后端项目中创建名为'choice_question'的Django应用
- 配置应用到settings.py的INSTALLED_APPS
- 安装必要依赖：django-mptt（分类树）、django-taggit（标签）

任务1.2：设计数据模型
- 创建Category模型（多级分类，使用MPTT）
  * name: 分类名称
  * parent: 父分类（自引用）
  * order: 排序
  * description: 描述
  * icon: 图标
  
- 创建Tag模型（标签）
  * name: 标签名
  * color: 标签颜色
  * usage_count: 使用次数
  
- 创建ChoiceQuestion模型（题目表）
  * title: 标题
  * description: 题目描述
  * question_type: 题型（单选/多选）
  * options: 选项（JSON）
  * correct_answer: 正确答案
  * explanation: 题目解析
  * score: 分值
  * difficulty: 难度
  * category: 所属分类（ForeignKey）
  * tags: 标签（ManyToMany）
  * created_by: 创建者
  * status: 状态（草稿/审核中/已发布）
  
- 创建ChoiceSubmission模型（提交记录）
  * question: 题目
  * user: 用户
  * selected_answer: 选择的答案
  * is_correct: 是否正确
  * submit_time: 提交时间
  * time_spent: 答题用时
  
- 创建WrongQuestion模型（错题本）
  * user: 用户
  * question: 题目
  * wrong_count: 错误次数
  * last_wrong_time: 最后错误时间
  * note: 错题笔记
  * is_mastered: 是否已掌握
  * review_times: 复习次数
  
- 创建UserQuestionStats模型（用户统计）
  * user: 用户
  * category: 分类
  * total_count: 总答题数
  * correct_count: 正确数
  * accuracy_rate: 正确率

任务1.3：实现基础API
- 分类API
  * GET /api/categories/tree/ （获取分类树）
  * POST /api/categories/ （创建分类）
  * PUT /api/categories/{id}/ （更新分类）
  * DELETE /api/categories/{id}/ （删除分类）
  * POST /api/categories/{id}/move/ （移动分类）
  
- 标签API
  * GET /api/tags/ （标签列表）
  * GET /api/tags/popular/ （热门标签）
  * POST /api/tags/ （创建标签）
  * PUT /api/tags/{id}/ （更新标签）
  * DELETE /api/tags/{id}/ （删除标签）
  
- 题目API
  * GET /api/choice-questions/ （题目列表，支持分类/标签筛选）
  * GET /api/choice-questions/{id}/ （题目详情）
  * POST /api/choice-questions/ （创建题目）
  * PUT /api/choice-questions/{id}/ （更新题目）
  * DELETE /api/choice-questions/{id}/ （删除题目）
  * POST /api/choice-questions/{id}/submit/ （提交答案）
  * POST /api/choice-questions/{id}/favorite/ （收藏题目）
  
- 错题本API
  * GET /api/wrong-questions/ （错题列表）
  * GET /api/wrong-questions/stats/ （错题统计）
  * POST /api/wrong-questions/{id}/note/ （添加笔记）
  * POST /api/wrong-questions/{id}/review/ （复习错题）
  * DELETE /api/wrong-questions/{id}/ （移除错题）
  * GET /api/wrong-questions/export/ （导出错题）
```

### Step 2: 前端页面开发
```markdown
任务2.1：创建基础页面结构
- 在前端src/pages/oj/下创建choice-question目录
- 创建以下子目录结构：
  * components/（组件）
  * views/（页面）
  * api/（接口）
  * store/（状态管理）

任务2.2：分类管理页面
- CategoryTree.vue（分类树组件）
  * 使用OJ的Tree组件或Element UI的树形控件
  * 支持拖拽排序
  * 右键菜单（添加子分类/编辑/删除）
- CategoryManager.vue（分类管理页面）
  * 左侧分类树
  * 右侧分类详情和题目列表

任务2.3：标签管理页面
- TagCloud.vue（标签云组件）
  * 根据使用频率显示不同大小
  * 点击标签筛选题目
- TagManager.vue（标签管理页面）
  * 标签列表（表格形式）
  * 标签颜色选择器
  * 批量操作功能

任务2.4：题目列表页
- ChoiceQuestionList.vue
  * 顶部：分类面包屑导航
  * 左侧：分类树形筛选器
  * 主体：题目列表（复用OJ的Table组件）
  * 右侧：标签云筛选器
  * 支持多条件组合筛选

任务2.5：答题页面
- ChoiceQuestionDetail.vue
  * 题目信息展示（分类路径、标签、难度）
  * 选项展示（单选用Radio、多选用Checkbox）
  * 提交后显示答案解析
  * 收藏按钮、错题标记

任务2.6：错题本页面
- WrongQuestionBook.vue（错题本主页）
  * 错题分类统计图表
  * 错题列表（支持筛选）
  * 批量重做功能
- WrongQuestionDetail.vue（错题详情）
  * 显示历史答题记录
  * 错题笔记编辑器
  * 相似题目推荐
- WrongQuestionStats.vue（错题统计）
  * 按分类的错题分布饼图
  * 按时间的错题趋势图
  * 薄弱知识点分析

任务2.7：个人统计页面
- UserStats.vue
  * 总体答题统计
  * 分类正确率雷达图
  * 答题历史时间线
  * 进步趋势图
```

### Step 3: 功能集成
```markdown
任务3.1：菜单集成
- 在OJ的菜单配置中添加"选择题"主菜单
- 添加子菜单：
  * 题目列表
  * 分类浏览
  * 我的错题本
  * 答题统计
  * 管理中心（管理员）

任务3.2：权限集成
- 普通用户权限：
  * 查看和答题
  * 使用错题本
  * 查看个人统计
- 管理员权限：
  * 分类管理
  * 标签管理
  * 题目增删改
  * 查看所有统计

任务3.3：数据集成
- 将选择题成绩纳入用户总成绩
- 在用户Profile页面显示选择题统计
- 在排行榜中加入选择题排名
```

## 🎯 第二阶段：高级功能

### Step 4: 高级功能开发
```markdown
任务4.1：批量导入导出
- Excel/CSV模板设计
  * 支持分类路径导入
  * 支持多标签导入
- 导入预览和错误提示
- 导出功能（支持筛选条件）

任务4.2：智能推荐系统
- 基于错题的相似题推荐
- 基于薄弱点的针对性练习
- 每日推荐题目

任务4.3：练习模式
- 随机练习（指定数量和范围）
- 专项练习（按分类/标签）
- 错题重练模式
- 模拟测试（计时、打分）

任务4.4：题目审核流程
- 题目提交审核
- 审核队列管理
- 审核意见反馈
- 题目版本对比
```

## 🔌 第三阶段：插件化改造

### Step 5: 插件化架构
```markdown
任务5.1：代码解耦
- 提取核心功能为独立模块
- 定义插件接口规范
- 实现热插拔机制

任务5.2：安装程序开发
- 一键安装脚本
- 数据库自动迁移
- 依赖检查和安装
- 配置文件生成

任务5.3：管理界面
- 插件管理页面
- 在线安装/卸载
- 插件配置界面
- 版本更新机制
```

### 五、数据库设计详细说明

```python
# 分类模型（使用MPTT实现树形结构）
class Category(MPTTModel):
    name = models.CharField(max_length=100)
    parent = TreeForeignKey('self', null=True, blank=True)
    order = models.IntegerField(default=0)
    description = models.TextField(blank=True)
    icon = models.CharField(max_length=50, blank=True)
    question_count = models.IntegerField(default=0)
    
    class MPTTMeta:
        order_insertion_by = ['order']

# 标签模型
class Tag(models.Model):
    name = models.CharField(max_length=50, unique=True)
    color = models.CharField(max_length=7, default='#1890ff')
    usage_count = models.IntegerField(default=0)
    created_at = models.DateTimeField(auto_now_add=True)
    
# 题目模型
class ChoiceQuestion(models.Model):
    QUESTION_TYPES = (
        ('single', '单选题'),
        ('multiple', '多选题'),
    )
    STATUS_CHOICES = (
        ('draft', '草稿'),
        ('reviewing', '审核中'),
        ('published', '已发布'),
    )
    
    title = models.CharField(max_length=200)
    description = models.TextField()
    question_type = models.CharField(max_length=10, choices=QUESTION_TYPES)
    options = JSONField()  # [{"key": "A", "text": "选项内容"}, ...]
    correct_answer = models.CharField(max_length=10)  # "A" 或 "A,B,C"
    explanation = models.TextField(blank=True)
    score = models.IntegerField(default=10)
    difficulty = models.CharField(max_length=10)
    category = models.ForeignKey(Category, on_delete=models.PROTECT)
    tags = models.ManyToManyField(Tag)
    created_by = models.ForeignKey(User, on_delete=models.PROTECT)
    status = models.CharField(max_length=10, choices=STATUS_CHOICES)
    submit_count = models.IntegerField(default=0)
    correct_count = models.IntegerField(default=0)
    
# 错题本模型
class WrongQuestion(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    question = models.ForeignKey(ChoiceQuestion, on_delete=models.CASCADE)
    wrong_count = models.IntegerField(default=1)
    last_wrong_time = models.DateTimeField(auto_now=True)
    note = models.TextField(blank=True)
    is_mastered = models.BooleanField(default=False)
    review_times = models.IntegerField(default=0)
    
    class Meta:
        unique_together = ['user', 'question']
```

### 六、API接口详细设计

```yaml
# 分类相关接口
GET /api/choice/categories/tree/
Response: {
  "data": [
    {
      "id": 1,
      "name": "数据结构",
      "level": 0,
      "children": [
        {
          "id": 2,
          "name": "线性表",
          "level": 1,
          "children": []
        }
      ]
    }
  ]
}

# 错题本接口
GET /api/choice/wrong-questions/
Query Parameters:
  - category_id: 分类ID
  - tag_id: 标签ID
  - date_from: 开始日期
  - date_to: 结束日期
  - is_mastered: 是否已掌握
Response: {
  "count": 100,
  "results": [
    {
      "id": 1,
      "question": {...},
      "wrong_count": 3,
      "last_wrong_time": "2024-01-01T10:00:00Z",
      "note": "注意边界条件",
      "is_mastered": false
    }
  ]
}

# 提交答案接口
POST /api/choice/questions/{id}/submit/
Request: {
  "answer": "A,B",  // 多选用逗号分隔
  "time_spent": 120  // 秒
}
Response: {
  "is_correct": true,
  "correct_answer": "A,B",
  "explanation": "解析内容...",
  "score_earned": 10
}
```

### 七、前端组件设计规范

```javascript
// 使用OJ现有组件示例
<template>
  <div class="choice-question-container">
    <!-- 使用OJ的Panel组件 -->
    <Panel>
      <div slot="title">
        <Icon type="ios-list" />
        选择题列表
        <!-- 使用OJ的Badge组件显示数量 -->
        <Badge :count="totalCount" />
      </div>
      
      <!-- 使用OJ的筛选器组件 -->
      <div class="filter-section">
        <Row :gutter="10">
          <Col :span="6">
            <!-- 分类选择器 -->
            <Cascader 
              v-model="selectedCategory"
              :data="categoryTree"
              placeholder="选择分类"
            />
          </Col>
          <Col :span="6">
            <!-- 标签选择器 -->
            <Select 
              v-model="selectedTags"
              multiple
              placeholder="选择标签"
            >
              <Option 
                v-for="tag in tags" 
                :key="tag.id"
                :value="tag.id"
              >
                <Tag :color="tag.color">{{ tag.name }}</Tag>
              </Option>
            </Select>
          </Col>
        </Row>
      </div>
      
      <!-- 使用OJ的Table组件 -->
      <Table 
        :columns="columns"
        :data="questions"
        :loading="loading"
      />
      
      <!-- 使用OJ的分页组件 -->
      <div class="pagination">
        <Page 
          :total="total"
          :page-size="pageSize"
          @on-change="handlePageChange"
        />
      </div>
    </Panel>
  </div>
</template>
```

### 八、验证要点（增强版）

```markdown
## 功能检查清单
- [ ] 分类管理
  - [ ] 能否创建多级分类？
  - [ ] 分类拖拽排序是否正常？
  - [ ] 删除分类时是否有题目检查？
  
- [ ] 标签管理
  - [ ] 标签创建和颜色设置是否正常？
  - [ ] 热门标签统计是否准确？
  - [ ] 批量添加标签是否生效？
  
- [ ] 错题本
  - [ ] 错题是否自动收录？
  - [ ] 错题笔记是否能保存？
  - [ ] 错题重做是否更新统计？
  - [ ] 错题导出PDF是否正常？
  
- [ ] 数据统计
  - [ ] 分类正确率是否准确？
  - [ ] 图表展示是否正常？
  - [ ] 排行榜数据是否实时？

## UI一致性检查
- [ ] 所有页面是否使用OJ组件？
- [ ] 颜色主题是否统一？
- [ ] 图标风格是否一致？
- [ ] 响应式布局是否正常？
```

### 九、性能优化建议

```markdown
## 性能优化要点

1. **分类树优化**
   - 使用虚拟滚动处理大量分类
   - 分类数据缓存到Vuex
   - 懒加载子分类

2. **错题本优化**
   - 分页加载错题列表
   - 错题笔记使用防抖保存
   - 图片懒加载

3. **统计数据优化**
   - 使用Redis缓存统计数据
   - 定时任务更新统计
   - 图表数据按需加载

4. **批量操作优化**
   - 批量导入使用队列处理
   - 大文件分片上传
   - 进度条实时反馈
```

---

**使用建议：**
1. 先实现基础题目功能，确保答题流程通畅
2. 然后添加分类和标签系统
3. 接着实现错题本功能
4. 最后完善统计和高级功能
5. 每个功能模块完成后都要测试与OJ的集成

这份完善的文档涵盖了所有功能细节，您可以按需给Trae分配具体任务！