# 选择题插件前端实现文档

## 概述

本文档详细描述了选择题插件的前端实现，包括用户端答题界面和管理端管理界面的完整实现方案。

## 技术栈

- **框架**: Vue.js 2.x
- **UI组件库**: iView (用户端) / Element UI (管理端)
- **状态管理**: Vuex
- **路由**: Vue Router
- **HTTP客户端**: Axios
- **富文本编辑器**: tar-simditor
- **数学公式渲染**: MathJax
- **代码高亮**: highlight.js

## 用户端实现

### 1. 选择题列表页面 (ChoiceQuestionList.vue)

**路径**: `/choice-questions`

**功能特性**:
- 题目列表展示与筛选
- 支持按分类、标签、难度、题型筛选
- 关键词搜索功能
- 分页显示
- 题目状态显示（已做/未做/通过/答错）
- 通过率统计显示

**核心实现**:

```vue
<template>
  <div class="choice-question-list">
    <!-- 筛选器 -->
    <Card shadow>
      <div slot="title">
        <Icon type="ios-funnel" />
        筛选条件
      </div>
      <Form :model="filterParams" inline>
        <FormItem label="分类">
          <Select v-model="filterParams.category" placeholder="选择分类" clearable style="width: 150px">
            <Option v-for="category in categories" :key="category.id" :value="category.id">
              {{ category.name }}
            </Option>
          </Select>
        </FormItem>
        <FormItem label="标签">
          <Select v-model="filterParams.tag" placeholder="选择标签" clearable style="width: 150px">
            <Option v-for="tag in tags" :key="tag.id" :value="tag.id">
              {{ tag.name }}
            </Option>
          </Select>
        </FormItem>
        <FormItem label="难度">
          <Select v-model="filterParams.difficulty" placeholder="选择难度" clearable style="width: 120px">
            <Option value="easy">简单</Option>
            <Option value="medium">中等</Option>
            <Option value="hard">困难</Option>
          </Select>
        </FormItem>
        <FormItem label="题型">
          <Select v-model="filterParams.question_type" placeholder="选择题型" clearable style="width: 120px">
            <Option value="single">单选题</Option>
            <Option value="multiple">多选题</Option>
          </Select>
        </FormItem>
        <FormItem label="关键词">
          <Input v-model="filterParams.keyword" placeholder="搜索题目" style="width: 200px" />
        </FormItem>
        <FormItem>
          <Button type="primary" @click="getQuestionList(1)" icon="ios-search">搜索</Button>
          <Button @click="resetFilter" icon="ios-refresh" style="margin-left: 8px">重置</Button>
        </FormItem>
      </Form>
    </Card>
    
    <!-- 题目列表 -->
    <Card shadow style="margin-top: 20px">
      <div slot="title">
        <Icon type="ios-list" />
        选择题列表
        <span style="margin-left: 10px; font-size: 14px; color: #999;">共 {{ total }} 道题目</span>
      </div>
      <Table :data="questionList" :columns="columns" :loading="loading" stripe>
        <!-- 表格插槽实现 -->
      </Table>
      
      <!-- 分页 -->
      <div style="margin-top: 20px; text-align: right;">
        <Page
          :current="currentPage"
          :total="total"
          :page-size="pageSize"
          :page-size-opts="[10, 20, 50, 100]"
          show-sizer
          show-elevator
          show-total
          @on-change="handlePageChange"
          @on-page-size-change="handlePageSizeChange"
        />
      </div>
    </Card>
  </div>
</template>

<script>
import api from '@/common/api'

export default {
  name: 'ChoiceQuestionList',
  data() {
    return {
      questionList: [],
      categories: [],
      tags: [],
      total: 0,
      currentPage: 1,
      pageSize: 20,
      loading: false,
      filterParams: {
        category: '',
        tag: '',
        difficulty: '',
        question_type: '',
        keyword: ''
      },
      columns: [
        {
          title: '题目',
          slot: 'title',
          minWidth: 300
        },
        {
          title: '分类',
          slot: 'category',
          width: 120
        },
        {
          title: '标签',
          slot: 'tags',
          width: 150
        },
        {
          title: '难度',
          slot: 'difficulty',
          width: 100
        },
        {
          title: '题型',
          slot: 'question_type',
          width: 120
        },
        {
          title: '分值',
          key: 'score',
          width: 80
        },
        {
          title: '通过率',
          key: 'acceptance_rate',
          width: 100,
          render: (h, params) => {
            return h('span', (params.row.acceptance_rate * 100).toFixed(1) + '%')
          }
        },
        {
          title: '操作',
          slot: 'action',
          width: 120,
          align: 'center'
        }
      ]
    }
  },
  mounted() {
    this.getQuestionList()
    this.getCategories()
    this.getTags()
  },
  methods: {
    // 核心方法实现
    getQuestionList(page = 1) {
      this.loading = true
      this.currentPage = page
      
      const params = {
        page: this.currentPage,
        limit: this.pageSize,
        ...this.filterParams
      }
      
      api.getChoiceQuestionList(params).then(res => {
        this.questionList = res.data.results
        this.total = res.data.total
        this.loading = false
      }).catch(() => {
        this.loading = false
      })
    },
    
    goToQuestion(questionId) {
      this.$router.push({
        name: 'choice-question-detail',
        params: { questionId },
        query: this.filterParams
      })
    }
    // ... 其他方法
  }
}
</script>
```

### 2. 选择题详情页面 (ChoiceQuestionDetail.vue)

**路径**: `/choice-question/:questionId`

**功能特性**:
- 题目内容展示（支持富文本、数学公式、代码高亮）
- 选项选择交互
- 答案提交与结果展示
- 题目导航（上一题/下一题）
- 错题本功能
- 答题统计

**核心实现**:

```vue
<template>
  <div class="choice-question-detail">
    <!-- 题目信息卡片 -->
    <Card class="question-info-card">
      <div slot="title" class="question-header">
        <div class="question-meta">
          <Tag :color="getDifficultyColor(question.difficulty)">{{ getDifficultyText(question.difficulty) }}</Tag>
          <Tag color="blue">{{ question.question_type === 'single' ? '单选题' : '多选题' }}</Tag>
          <span class="question-score">{{ question.score }} 分</span>
        </div>
        <div class="question-actions">
          <Button v-if="!isCorrect && hasSubmitted" @click="addQuestionToWrongBook" type="warning" size="small">
            <Icon type="ios-bookmark" /> 加入错题本
          </Button>
        </div>
      </div>
      
      <div class="question-content">
        <h2 class="question-title">{{ question.title }}</h2>
        <div class="question-description" v-html="question.description" ref="questionContent"></div>
      </div>
    </Card>
    
    <!-- 选项区域 -->
    <Card class="options-card" style="margin-top: 20px;">
      <div slot="title">
        <Icon type="ios-list" />
        选择答案
      </div>
      
      <div class="options-container">
        <div 
          v-for="(option, index) in question.options" 
          :key="index"
          class="option-item"
          :class="{
            'selected': isOptionSelected(index),
            'correct': hasSubmitted && isCorrectOption(index),
            'wrong': hasSubmitted && isOptionSelected(index) && !isCorrectOption(index),
            'disabled': hasSubmitted
          }"
          @click="selectOption(index)"
        >
          <div class="option-content">
            <div class="option-label">{{ getOptionLabel(index) }}</div>
            <div class="option-text" v-html="option" ref="optionContent"></div>
          </div>
          <div class="option-indicator">
            <Icon v-if="question.question_type === 'single'" type="ios-radio-button-on" v-show="isOptionSelected(index)" />
            <Icon v-else type="ios-checkbox" :class="{ 'checked': isOptionSelected(index) }" />
          </div>
        </div>
      </div>
    </Card>
    
    <!-- 提交区域 -->
    <Card class="submit-card" style="margin-top: 20px;">
      <div class="submit-actions">
        <Button 
          type="primary" 
          size="large"
          :loading="submitting"
          :disabled="!canSubmit || hasSubmitted"
          @click="submitAnswer"
        >
          {{ hasSubmitted ? '已提交' : '提交答案' }}
        </Button>
        <Button v-if="hasSubmitted" @click="resetQuestionState" style="margin-left: 10px;">重新答题</Button>
      </div>
    </Card>
    
    <!-- 结果展示 -->
    <Card v-if="hasSubmitted" class="result-card" style="margin-top: 20px;">
      <div slot="title">
        <Icon :type="isCorrect ? 'ios-checkmark-circle' : 'ios-close-circle'" />
        {{ isCorrect ? '回答正确' : '回答错误' }}
      </div>
      
      <div class="result-content">
        <div class="score-info">
          <span class="score-text">得分：</span>
          <span class="score-value" :class="{ 'correct': isCorrect, 'wrong': !isCorrect }">
            {{ currentScore }} / {{ question.score }}
          </span>
        </div>
        
        <div v-if="question.explanation" class="explanation">
          <h4>题目解析：</h4>
          <div class="explanation-content" v-html="question.explanation" ref="explanationContent"></div>
        </div>
      </div>
    </Card>
    
    <!-- 导航按钮 -->
    <div v-if="showNavigation" class="navigation-buttons">
      <Button 
        v-if="hasPreviousQuestion" 
        @click="goToPreviousQuestion" 
        icon="ios-arrow-back"
        style="margin-right: 10px;"
      >
        上一题
      </Button>
      <Button 
        v-if="hasNextQuestion" 
        @click="goToNextQuestion" 
        icon="ios-arrow-forward"
        type="primary"
      >
        下一题
      </Button>
    </div>
  </div>
</template>

<script>
import api from '@/common/api'
import { mapGetters } from 'vuex'
import hljs from 'highlight.js'

export default {
  name: 'ChoiceQuestionDetail',
  data() {
    return {
      question: {},
      selectedAnswer: null,
      selectedAnswers: [],
      hasSubmitted: false,
      isCorrect: false,
      currentScore: 0,
      submitting: false,
      questionList: [],
      currentIndex: -1,
      filterParams: {}
    }
  },
  computed: {
    ...mapGetters(['user']),
    
    questionId() {
      return this.$route.params.questionId
    },
    
    canSubmit() {
      if (this.question.question_type === 'single') {
        return this.selectedAnswer !== null
      } else {
        return this.selectedAnswers.length > 0
      }
    },
    
    hasPreviousQuestion() {
      return this.currentIndex > 0
    },
    
    hasNextQuestion() {
      return this.currentIndex < this.questionList.length - 1
    },
    
    showNavigation() {
      return this.questionList.length > 1
    }
  },
  
  watch: {
    '$route'(to, from) {
      if (to.params.questionId !== from.params.questionId) {
        this.resetQuestionState()
        this.getQuestionDetail()
        this.filterParams = { ...to.query }
      }
    }
  },
  
  mounted() {
    this.getQuestionDetail()
    this.filterParams = { ...this.$route.query }
    this.getQuestionListForNavigation()
  },
  
  methods: {
    // 重置题目状态
    resetQuestionState() {
      this.selectedAnswer = null
      this.selectedAnswers = []
      this.hasSubmitted = false
      this.isCorrect = false
      this.currentScore = 0
      this.submitting = false
    },
    
    // 选择选项
    selectOption(index) {
      if (this.hasSubmitted) return
      
      if (this.question.question_type === 'single') {
        this.selectedAnswer = index
      } else {
        const selectedIndex = this.selectedAnswers.indexOf(index)
        if (selectedIndex > -1) {
          this.selectedAnswers.splice(selectedIndex, 1)
        } else {
          this.selectedAnswers.push(index)
        }
      }
    },
    
    // 判断选项是否被选中
    isOptionSelected(index) {
      if (this.question.question_type === 'single') {
        return this.selectedAnswer === index
      } else {
        return this.selectedAnswers.includes(index)
      }
    },
    
    // 判断选项是否正确
    isCorrectOption(index) {
      if (!this.question.correct_answer) return false
      const correctAnswers = this.question.correct_answer.split(',').map(ans => {
        const trimmed = ans.trim()
        if (trimmed.match(/^[0-9]+$/)) {
          return parseInt(trimmed)
        } else {
          return trimmed.charCodeAt(0) - 'A'.charCodeAt(0)
        }
      })
      return correctAnswers.includes(index)
    },
    
    // 获取选项标签
    getOptionLabel(index) {
      return String.fromCharCode(65 + index) // A, B, C, D...
    },
    
    // 提交答案
    async submitAnswer() {
      if (!this.canSubmit || this.hasSubmitted) return
      
      this.submitting = true
      
      try {
        let userAnswer
        if (this.question.question_type === 'single') {
          userAnswer = this.selectedAnswer
        } else {
          userAnswer = this.selectedAnswers.sort()
        }
        
        const response = await api.submitChoiceQuestionAnswer({
          question_id: this.questionId,
          user_answer: userAnswer
        })
        
        this.hasSubmitted = true
        this.isCorrect = response.data.is_correct
        this.currentScore = response.data.score
        
        this.$Message.success(this.isCorrect ? '回答正确！' : '回答错误，请查看解析')
        
      } catch (error) {
        this.$Message.error('提交失败，请重试')
      } finally {
        this.submitting = false
      }
    },
    
    // 获取题目详情
    async getQuestionDetail() {
      try {
        const response = await api.getChoiceQuestionDetail(this.questionId)
        this.question = response.data
        
        // 渲染数学公式和代码高亮
        this.$nextTick(() => {
          this.renderMath()
          this.highlightCode()
        })
        
      } catch (error) {
        this.$Message.error('获取题目详情失败')
        this.$router.push({ name: 'choice-question-list' })
      }
    },
    
    // 数学公式渲染
    renderMath() {
      if (window.MathJax) {
        window.MathJax.typesetPromise([this.$el]).catch((err) => {
          console.warn('MathJax渲染失败:', err)
        })
      }
    },
    
    // 代码高亮
    highlightCode() {
      this.$nextTick(() => {
        const codeBlocks = this.$el.querySelectorAll('pre code')
        codeBlocks.forEach((block) => {
          hljs.highlightBlock(block)
        })
      })
    },
    
    // 获取难度颜色
    getDifficultyColor(difficulty) {
      const colorMap = {
        'easy': 'success',
        'medium': 'warning', 
        'hard': 'error'
      }
      return colorMap[difficulty] || 'default'
    },
    
    // 获取难度文本
    getDifficultyText(difficulty) {
      const textMap = {
        'easy': '简单',
        'medium': '中等',
        'hard': '困难'
      }
      return textMap[difficulty] || '未知'
    }
    
    // ... 其他方法实现
  }
}
</script>

<style scoped>
/* 详细的CSS样式实现 */
.choice-question-detail {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
}

.question-info-card .question-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.question-meta {
  display: flex;
  align-items: center;
  gap: 10px;
}

.question-score {
  font-weight: bold;
  color: #2d8cf0;
}

.question-content {
  margin-top: 20px;
}

.question-title {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 15px;
  color: #333;
}

.question-description {
  line-height: 1.6;
  color: #666;
}

.options-container {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.option-item {
  display: flex;
  align-items: flex-start;
  padding: 15px;
  border: 2px solid #e8eaec;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: #fff;
}

.option-item:hover:not(.disabled) {
  border-color: #2d8cf0;
  box-shadow: 0 2px 8px rgba(45, 140, 240, 0.1);
}

.option-item.selected {
  border-color: #2d8cf0;
  background: #f0f8ff;
}

.option-item.correct {
  border-color: #19be6b;
  background: #f0f9f0;
}

.option-item.wrong {
  border-color: #ed4014;
  background: #fff2f0;
}

.option-item.disabled {
  cursor: not-allowed;
  opacity: 0.8;
}

.option-content {
  flex: 1;
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.option-label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: #f5f5f5;
  color: #666;
  font-weight: bold;
  font-size: 14px;
  flex-shrink: 0;
}

.option-item.selected .option-label {
  background: #2d8cf0;
  color: white;
}

.option-item.correct .option-label {
  background: #19be6b;
  color: white;
}

.option-item.wrong .option-label {
  background: #ed4014;
  color: white;
}

.option-text {
  flex: 1;
  line-height: 1.5;
  color: #333;
}

.option-indicator {
  margin-left: 10px;
  font-size: 18px;
  color: #2d8cf0;
}

.submit-card {
  text-align: center;
}

.submit-actions {
  padding: 20px 0;
}

.result-card .score-info {
  margin-bottom: 20px;
  text-align: center;
}

.score-text {
  font-size: 16px;
  color: #666;
}

.score-value {
  font-size: 24px;
  font-weight: bold;
  margin-left: 10px;
}

.score-value.correct {
  color: #19be6b;
}

.score-value.wrong {
  color: #ed4014;
}

.explanation {
  text-align: left;
  padding: 20px;
  background: #f8f8f9;
  border-radius: 6px;
}

.explanation h4 {
  margin-bottom: 10px;
  color: #333;
}

.explanation-content {
  line-height: 1.6;
  color: #666;
}

.navigation-buttons {
  text-align: center;
  margin-top: 30px;
  padding: 20px 0;
}

/* 富文本内容样式 */
.question-description img,
.option-text img,
.explanation-content img {
  max-width: 100%;
  height: auto;
  border-radius: 4px;
  margin: 10px 0;
}

.question-description pre,
.option-text pre,
.explanation-content pre {
  background: #f5f5f5;
  padding: 15px;
  border-radius: 4px;
  overflow-x: auto;
  margin: 10px 0;
}

.question-description code,
.option-text code,
.explanation-content code {
  background: #f5f5f5;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'Monaco', 'Consolas', monospace;
}

/* 数学公式样式 */
.MathJax {
  font-size: 1.1em !important;
}

/* 响应式设计 */
@media (max-width: 768px) {
  .choice-question-detail {
    padding: 10px;
  }
  
  .question-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .option-content {
    flex-direction: column;
    gap: 8px;
  }
  
  .option-label {
    align-self: flex-start;
  }
}
</style>
```

## 管理端实现

### 1. 分类管理界面

**路径**: `/admin/choice-question/category`

**功能特性**:
- 分类的增删改查
- 树形结构展示
- 拖拽排序
- 批量操作

### 2. 标签管理界面

**路径**: `/admin/choice-question/tag`

**功能特性**:
- 标签的增删改查
- 颜色管理
- 使用统计

### 3. 题目管理界面

**路径**: `/admin/choice-question/question`

**功能特性**:
- 题目的增删改查
- 富文本编辑器集成
- 批量导入导出
- 统计分析

## 路由配置

### 用户端路由

```javascript
// 用户端路由配置
const choiceQuestionRoutes = [
  {
    path: '/choice-questions',
    name: 'choice-question-list',
    component: () => import('@/pages/oj/views/choice-question/ChoiceQuestionList.vue'),
    meta: {
      title: '选择题练习'
    }
  },
  {
    path: '/choice-question/:questionId',
    name: 'choice-question-detail', 
    component: () => import('@/pages/oj/views/choice-question/ChoiceQuestionDetail.vue'),
    meta: {
      title: '选择题详情'
    }
  },
  {
    path: '/choice-question/random',
    name: 'choice-question-random',
    component: () => import('@/pages/oj/views/choice-question/ChoiceQuestionRandom.vue'),
    meta: {
      title: '随机练习'
    }
  },
  {
    path: '/choice-question/wrong-book',
    name: 'choice-question-wrong-book',
    component: () => import('@/pages/oj/views/choice-question/ChoiceQuestionWrongBook.vue'),
    meta: {
      title: '错题本',
      requireAuth: true
    }
  }
]
```

### 管理端路由

```javascript
// 管理端路由配置
const adminChoiceQuestionRoutes = [
  {
    path: '/admin/choice-question',
    component: () => import('@/pages/admin/views/choice-question/ChoiceQuestionManagement.vue'),
    children: [
      {
        path: '',
        redirect: 'question'
      },
      {
        path: 'question',
        name: 'admin-choice-question-list',
        component: () => import('@/pages/admin/views/choice-question/QuestionList.vue'),
        meta: {
          title: '题目管理'
        }
      },
      {
        path: 'question/create',
        name: 'admin-choice-question-create',
        component: () => import('@/pages/admin/views/choice-question/QuestionEditor.vue'),
        meta: {
          title: '创建题目'
        }
      },
      {
        path: 'question/:questionId/edit',
        name: 'admin-choice-question-edit',
        component: () => import('@/pages/admin/views/choice-question/QuestionEditor.vue'),
        meta: {
          title: '编辑题目'
        }
      },
      {
        path: 'category',
        name: 'admin-choice-question-category',
        component: () => import('@/pages/admin/views/choice-question/CategoryManagement.vue'),
        meta: {
          title: '分类管理'
        }
      },
      {
        path: 'tag',
        name: 'admin-choice-question-tag',
        component: () => import('@/pages/admin/views/choice-question/TagManagement.vue'),
        meta: {
          title: '标签管理'
        }
      },
      {
        path: 'statistics',
        name: 'admin-choice-question-statistics',
        component: () => import('@/pages/admin/views/choice-question/Statistics.vue'),
        meta: {
          title: '统计分析'
        }
      }
    ]
  }
]
```

## API接口封装

```javascript
// api/choice-question.js
import request from '@/utils/request'

export default {
  // 用户端API
  getChoiceQuestionList(params) {
    return request({
      url: '/api/choice-question/',
      method: 'get',
      params
    })
  },
  
  getChoiceQuestionDetail(questionId) {
    return request({
      url: `/api/choice-question/${questionId}/`,
      method: 'get'
    })
  },
  
  submitChoiceQuestionAnswer(data) {
    return request({
      url: '/api/choice-question/submit/',
      method: 'post',
      data
    })
  },
  
  getRandomChoiceQuestion(params) {
    return request({
      url: '/api/choice-question/random/',
      method: 'get',
      params
    })
  },
  
  getChoiceQuestionCategories() {
    return request({
      url: '/api/choice-question/category/',
      method: 'get'
    })
  },
  
  getChoiceQuestionTags() {
    return request({
      url: '/api/choice-question/tag/',
      method: 'get'
    })
  },
  
  // 管理端API
  adminGetChoiceQuestionList(params) {
    return request({
      url: '/api/admin/choice-question/',
      method: 'get',
      params
    })
  },
  
  adminCreateChoiceQuestion(data) {
    return request({
      url: '/api/admin/choice-question/',
      method: 'post',
      data
    })
  },
  
  adminUpdateChoiceQuestion(questionId, data) {
    return request({
      url: `/api/admin/choice-question/${questionId}/`,
      method: 'put',
      data
    })
  },
  
  adminDeleteChoiceQuestion(questionId) {
    return request({
      url: `/api/admin/choice-question/${questionId}/`,
      method: 'delete'
    })
  },
  
  // 分类管理API
  adminGetCategories() {
    return request({
      url: '/api/admin/choice-question/category/',
      method: 'get'
    })
  },
  
  adminCreateCategory(data) {
    return request({
      url: '/api/admin/choice-question/category/',
      method: 'post',
      data
    })
  },
  
  // 标签管理API
  adminGetTags() {
    return request({
      url: '/api/admin/choice-question/tag/',
      method: 'get'
    })
  },
  
  adminCreateTag(data) {
    return request({
      url: '/api/admin/choice-question/tag/',
      method: 'post',
      data
    })
  }
}
```

## 状态管理

```javascript
// store/modules/choice-question.js
const state = {
  currentQuestion: null,
  questionList: [],
  categories: [],
  tags: [],
  userSubmissions: {},
  wrongQuestions: []
}

const mutations = {
  SET_CURRENT_QUESTION(state, question) {
    state.currentQuestion = question
  },
  
  SET_QUESTION_LIST(state, list) {
    state.questionList = list
  },
  
  SET_CATEGORIES(state, categories) {
    state.categories = categories
  },
  
  SET_TAGS(state, tags) {
    state.tags = tags
  },
  
  ADD_USER_SUBMISSION(state, { questionId, submission }) {
    state.userSubmissions[questionId] = submission
  },
  
  ADD_WRONG_QUESTION(state, question) {
    const exists = state.wrongQuestions.find(q => q.id === question.id)
    if (!exists) {
      state.wrongQuestions.push(question)
    }
  }
}

const actions = {
  async fetchQuestionDetail({ commit }, questionId) {
    try {
      const response = await api.getChoiceQuestionDetail(questionId)
      commit('SET_CURRENT_QUESTION', response.data)
      return response.data
    } catch (error) {
      throw error
    }
  },
  
  async submitAnswer({ commit }, { questionId, userAnswer }) {
    try {
      const response = await api.submitChoiceQuestionAnswer({
        question_id: questionId,
        user_answer: userAnswer
      })
      
      commit('ADD_USER_SUBMISSION', {
        questionId,
        submission: response.data
      })
      
      return response.data
    } catch (error) {
      throw error
    }
  }
}

const getters = {
  getCurrentQuestion: state => state.currentQuestion,
  getQuestionList: state => state.questionList,
  getCategories: state => state.categories,
  getTags: state => state.tags,
  getUserSubmission: state => questionId => state.userSubmissions[questionId],
  getWrongQuestions: state => state.wrongQuestions
}

export default {
  namespaced: true,
  state,
  mutations,
  actions,
  getters
}
```

## 工具函数

```javascript
// utils/choice-question.js

/**
 * 格式化难度显示
 */
export function formatDifficulty(difficulty) {
  const map = {
    'easy': { text: '简单', color: 'success' },
    'medium': { text: '中等', color: 'warning' },
    'hard': { text: '困难', color: 'error' }
  }
  return map[difficulty] || { text: '未知', color: 'default' }
}

/**
 * 格式化题型显示
 */
export function formatQuestionType(type) {
  const map = {
    'single': '单选题',
    'multiple': '多选题'
  }
  return map[type] || '未知'
}

/**
 * 计算通过率
 */
export function calculateAcceptanceRate(totalSubmit, totalAccepted) {
  if (totalSubmit === 0) return 0
  return (totalAccepted / totalSubmit * 100).toFixed(1)
}

/**
 * 解析选项标签
 */
export function getOptionLabel(index) {
  return String.fromCharCode(65 + index) // A, B, C, D...
}

/**
 * 解析用户答案
 */
export function parseUserAnswer(answer, questionType) {
  if (!answer) return []
  
  if (questionType === 'single') {
    return [answer]
  } else {
    return Array.isArray(answer) ? answer : [answer]
  }
}

/**
 * 验证答案格式
 */
export function validateAnswer(answer, questionType, optionsCount) {
  if (!answer) return false
  
  const parsedAnswer = parseUserAnswer(answer, questionType)
  
  // 检查答案是否在有效范围内
  for (const ans of parsedAnswer) {
    if (ans < 0 || ans >= optionsCount) {
      return false
    }
  }
  
  // 单选题只能有一个答案
  if (questionType === 'single' && parsedAnswer.length !== 1) {
    return false
  }
  
  // 多选题至少要有一个答案
  if (questionType === 'multiple' && parsedAnswer.length === 0) {
    return false
  }
  
  return true
}
```

## 样式主题

```scss
// styles/choice-question.scss

// 选择题主题色彩
$choice-primary: #2d8cf0;
$choice-success: #19be6b;
$choice-warning: #ff9900;
$choice-error: #ed4014;
$choice-info: #909399;

// 难度颜色
$difficulty-easy: #19be6b;
$difficulty-medium: #ff9900;
$difficulty-hard: #ed4014;

// 选项状态颜色
$option-default: #e8eaec;
$option-selected: #2d8cf0;
$option-correct: #19be6b;
$option-wrong: #ed4014;

// 通用样式
.choice-question {
  // 卡片样式
  .question-card {
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease;
    
    &:hover {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
  }
  
  // 标签样式
  .difficulty-tag {
    &.easy { background-color: $difficulty-easy; }
    &.medium { background-color: $difficulty-medium; }
    &.hard { background-color: $difficulty-hard; }
  }
  
  // 选项样式
  .option-item {
    transition: all 0.3s ease;
    
    &.selected {
      border-color: $option-selected;
      background-color: rgba($option-selected, 0.1);
    }
    
    &.correct {
      border-color: $option-correct;
      background-color: rgba($option-correct, 0.1);
    }
    
    &.wrong {
      border-color: $option-wrong;
      background-color: rgba($option-wrong, 0.1);
    }
  }
  
  // 响应式设计
  @media (max-width: 768px) {
    .question-card {
      margin: 10px;
      border-radius: 6px;
    }
    
    .option-item {
      padding: 12px;
      margin-bottom: 10px;
    }
  }
}

// 管理端样式
.admin-choice-question {
  .toolbar {
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .filter-form {
    background: #f8f8f9;
    padding: 20px;
    border-radius: 6px;
    margin-bottom: 20px;
  }
  
  .statistics-card {
    text-align: center;
    
    .stat-number {
      font-size: 24px;
      font-weight: bold;
      color: $choice-primary;
    }
    
    .stat-label {
      color: #666;
      margin-top: 5px;
    }
  }
}
```

## 部署配置

### 1. 构建配置

```javascript
// vue.config.js
module.exports = {
  // 选择题插件特定配置
  configureWebpack: {
    resolve: {
      alias: {
        '@choice-question': path.resolve(__dirname, 'src/pages/oj/views/choice-question'),
        '@choice-question-admin': path.resolve(__dirname, 'src/pages/admin/views/choice-question')
      }
    }
  },
  
  // 代码分割
  chainWebpack: config => {
    config.optimization.splitChunks({
      chunks: 'all',
      cacheGroups: {
        choiceQuestion: {
          name: 'choice-question',
          test: /[\\/]choice-question[\\/]/,
          priority: 10
        }
      }
    })
  }
}
```

### 2. 环境配置

```javascript
// .env.development
VUE_APP_CHOICE_QUESTION_API_BASE=/api/choice-question
VUE_APP_CHOICE_QUESTION_ADMIN_API_BASE=/api/admin/choice-question

// .env.production  
VUE_APP_CHOICE_QUESTION_API_BASE=/api/choice-question
VUE_APP_CHOICE_QUESTION_ADMIN_API_BASE=/api/admin/choice-question
```

## 测试策略

### 1. 单元测试

```javascript
// tests/unit/choice-question.spec.js
import { shallowMount } from '@vue/test-utils'
import ChoiceQuestionDetail from '@/pages/oj/views/choice-question/ChoiceQuestionDetail.vue'

describe('ChoiceQuestionDetail.vue', () => {
  it('renders question title correctly', () => {
    const question = {
      title: '测试题目',
      description: '测试描述',
      options: ['选项A', '选项B', '选项C', '选项D'],
      question_type: 'single'
    }
    
    const wrapper = shallowMount(ChoiceQuestionDetail, {
      data() {
        return { question }
      }
    })
    
    expect(wrapper.find('.question-title').text()).toBe('测试题目')
  })
  
  it('handles option selection correctly', async () => {
    const wrapper = shallowMount(ChoiceQuestionDetail)
    
    await wrapper.vm.selectOption(0)
    expect(wrapper.vm.selectedAnswer).toBe(0)
  })
})
```

### 2. 集成测试

```javascript
// tests/e2e/choice-question.spec.js
describe('Choice Question E2E Tests', () => {
  it('should complete a full question answering flow', () => {
    cy.visit('/choice-questions')
    cy.get('.question-list .question-item').first().click()
    cy.get('.option-item').first().click()
    cy.get('.submit-button').click()
    cy.get('.result-card').should('be.visible')
  })
})
```

## 性能优化

### 1. 懒加载

```javascript
// 路由懒加载
const ChoiceQuestionList = () => import('@/pages/oj/views/choice-question/ChoiceQuestionList.vue')
const ChoiceQuestionDetail = () => import('@/pages/oj/views/choice-question/ChoiceQuestionDetail.vue')
```

### 2. 缓存策略

```javascript
// 组件缓存
<keep-alive include="ChoiceQuestionList">
  <router-view />
</keep-alive>

// API缓存
const cache = new Map()

export function getCachedQuestionList(params) {
  const key = JSON.stringify(params)
  if (cache.has(key)) {
    return Promise.resolve(cache.get(key))
  }
  
  return api.getChoiceQuestionList(params).then(response => {
    cache.set(key, response)
    return response
  })
}
```

### 3. 图片优化

```javascript
// 图片懒加载
import VueLazyload from 'vue-lazyload'

Vue.use(VueLazyload, {
  preLoad: 1.3,
  error: '/static/img/error.png',
  loading: '/static/img/loading.gif',
  attempt: 1
})
```

## 总结

本前端实现文档涵盖了选择题插件的完整前端架构，包括：

1. **用户端实现**：题目列表、详情页面、答题交互
2. **管理端实现**：题目管理、分类管理、标签管理
3. **技术架构**：路由配置、状态管理、API封装
4. **工程化**：构建配置、测试策略、性能优化

该实现方案确保了：
- 良好的用户体验
- 完整的管理功能
- 可维护的代码结构
- 高性能的运行效率
- 全面的测试覆盖