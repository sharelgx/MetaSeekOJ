# ğŸ“˜ é’å²›OJé€‰æ‹©é¢˜æ’ä»¶å¼€å‘æ–‡æ¡£ï¼ˆæ’ä»¶åŒ–Â·ç‹¬ç«‹ç›®å½•ç‰ˆï¼‰
## ä¸€ã€é¡¹ç›®æ€»ä½“ç›®æ ‡
åŸºäº**é’å²›OJï¼ˆQDUOJï¼‰ç³»ç»Ÿ**å¼€å‘**ç‹¬ç«‹ç›®å½•ç»“æ„çš„é€‰æ‹©é¢˜åŠŸèƒ½æ’ä»¶**ï¼Œæ ¸å¿ƒç›®æ ‡å¦‚ä¸‹ï¼š
1. **æ’ä»¶ç‹¬ç«‹æ€§**ï¼šåç«¯ã€å‰ç«¯å‡é‡‡ç”¨ç‹¬ç«‹ç›®å½•å¼€å‘ï¼Œä¸ä¿®æ”¹OJæ ¸å¿ƒä»£ç ï¼Œä»…é€šè¿‡æ’ä»¶æ¥å£ä¸åŸç³»ç»Ÿäº¤äº’ï¼›
2. **æ— ç¼é›†æˆæ€§**ï¼šUIé£æ ¼ã€ç”¨æˆ·ä½“ç³»ã€æƒé™ç³»ç»Ÿã€æ•°æ®ç»Ÿè®¡å®Œå…¨å¯¹é½åŸOJï¼Œæ— â€œç¬¬ä¸‰æ–¹æ’ä»¶â€å‰²è£‚æ„Ÿï¼›
3. **å®Œæ•´åŠŸèƒ½æ€§**ï¼šæ”¯æŒå•é€‰/å¤šé€‰é¢˜ã€å¤šçº§åˆ†ç±»ã€æ ‡ç­¾ç®¡ç†ã€é”™é¢˜æœ¬ã€æ‰¹é‡å¯¼å…¥å¯¼å‡ºç­‰æ ¸å¿ƒåŠŸèƒ½ï¼›
4. **å¯æ’æ‹”æ€§**ï¼šæ”¯æŒä¸€é”®å®‰è£…ã€å¸è½½ã€å‡çº§ï¼Œå®‰è£…æ—¶è‡ªåŠ¨å®Œæˆæ•°æ®åº“è¿ç§»ï¼Œå¸è½½æ—¶æ¸…ç†æ®‹ç•™æ•°æ®ï¼›
5. **ä½è€¦åˆæ€§**ï¼šé€šè¿‡åŸOJçš„æ’ä»¶æ‰©å±•æ¥å£ï¼ˆæˆ–åŠ¨æ€æ³¨å…¥æ–¹å¼ï¼‰å®ç°é›†æˆï¼Œä¸ä¾èµ–åŸOJæ ¸å¿ƒä»£ç ä¿®æ”¹ã€‚


## äºŒã€æ’ä»¶ç›®å½•ç»“æ„è®¾è®¡ï¼ˆæ ¸å¿ƒï¼šç‹¬ç«‹ç›®å½•ï¼‰
æ’ä»¶æ ¹ç›®å½•ç»Ÿä¸€ä¸º `qduoj-choice-plugin/`ï¼Œå†…éƒ¨æŒ‰â€œåç«¯-å‰ç«¯-éƒ¨ç½²è„šæœ¬â€åˆ†ç¦»ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
```
qduoj-choice-plugin/
â”œâ”€â”€ backend/                # åç«¯æ’ä»¶ç›®å½•ï¼ˆç‹¬ç«‹Django Appï¼‰
â”‚   â”œâ”€â”€ choice_plugin/      # æ’ä»¶æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ plugin.py       # æ’ä»¶å…¥å£ï¼ˆå£°æ˜å…ƒä¿¡æ¯ã€ç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰
â”‚   â”‚   â”œâ”€â”€ apps.py         # Django Appé…ç½®ï¼ˆç‹¬ç«‹æ³¨å†Œï¼‰
â”‚   â”‚   â”œâ”€â”€ models/         # æ’ä»¶ç‹¬ç«‹æ•°æ®æ¨¡å‹ï¼ˆä¸ä¿®æ”¹åŸOJè¡¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ category.py # åˆ†ç±»æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ question.py # é¢˜ç›®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ wrong_book.py # é”™é¢˜æœ¬æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ api/            # æ’ä»¶ç‹¬ç«‹APIï¼ˆå¸¦æ’ä»¶å‰ç¼€ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ serializers.py # åºåˆ—åŒ–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ views.py    # APIè§†å›¾
â”‚   â”‚   â”‚   â””â”€â”€ urls.py     # æ’ä»¶å†…éƒ¨URLï¼ˆä¸ä¿®æ”¹åŸOJè·¯ç”±ï¼‰
â”‚   â”‚   â”œâ”€â”€ migrations/     # æ’ä»¶ç‹¬ç«‹æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ utils/          # æ’ä»¶å·¥å…·ç±»ï¼ˆå¦‚å¯¼å…¥å¯¼å‡ºã€åˆ¤é¢˜é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ requirements.txt    # æ’ä»¶åç«¯ä¾èµ–ï¼ˆå¦‚django-mpttã€django-taggitï¼‰
â”‚   â”œâ”€â”€ setup.py            # æ’ä»¶å®‰è£…è„šæœ¬ï¼ˆæ”¯æŒpip installï¼‰
â”‚   â””â”€â”€ uninstall.py        # æ’ä»¶å¸è½½è„šæœ¬ï¼ˆæ¸…ç†æ•°æ®åº“ã€é…ç½®ï¼‰
â”‚
â”œâ”€â”€ frontend/               # å‰ç«¯æ’ä»¶ç›®å½•ï¼ˆç‹¬ç«‹Vueæ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ plugin-entry.js # å‰ç«¯æ’ä»¶å…¥å£ï¼ˆå£°æ˜è·¯ç”±ã€èœå•ã€ç”Ÿå‘½å‘¨æœŸï¼‰
â”‚   â”‚   â”œâ”€â”€ api/            # æ’ä»¶APIå°è£…ï¼ˆè¯·æ±‚å¸¦æ’ä»¶å‰ç¼€ï¼‰
â”‚   â”‚   â”œâ”€â”€ components/     # æ’ä»¶ç‹¬ç«‹ç»„ä»¶ï¼ˆå¦‚åˆ†ç±»æ ‘ã€æ ‡ç­¾äº‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ views/          # æ’ä»¶é¡µé¢ï¼ˆé¢˜ç›®åˆ—è¡¨ã€ç­”é¢˜é¡µã€é”™é¢˜æœ¬ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ChoiceList.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ChoiceDetail.vue
â”‚   â”‚   â”‚   â””â”€â”€ WrongBook.vue
â”‚   â”‚   â”œâ”€â”€ store/          # æ’ä»¶ç‹¬ç«‹çŠ¶æ€ç®¡ç†ï¼ˆä¸æ±¡æŸ“åŸOJ Vuexï¼‰
â”‚   â”‚   â””â”€â”€ styles/         # æ’ä»¶æ ·å¼ï¼ˆå¤ç”¨åŸOJå˜é‡ï¼Œé¿å…å†²çªï¼‰
â”‚   â”œâ”€â”€ package.json        # å‰ç«¯ä¾èµ–å£°æ˜
â”‚   â””â”€â”€ vue.config.js       # å‰ç«¯æ„å»ºé…ç½®ï¼ˆè¾“å‡ºä¸ºæ’ä»¶å¯ç”¨èµ„æºï¼‰
â”‚
â””â”€â”€ plugin.json             # æ’ä»¶å…ƒä¿¡æ¯ï¼ˆåç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–OJç‰ˆæœ¬ã€å…¥å£æ–‡ä»¶ï¼‰
```


## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚ï¼ˆæ’ä»¶å†…å®ç°ï¼Œä¸ä¾èµ–åŸOJæ ¸å¿ƒï¼‰
| åŠŸèƒ½æ¨¡å—       | å…·ä½“åŠŸèƒ½ç‚¹                                                                 | å®ç°è¯´æ˜ï¼ˆæ’ä»¶åŒ–ç‰¹æ€§ï¼‰                                                                 |
|----------------|--------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
| 1. é¢˜ç›®ç®¡ç†     | å•é€‰/å¤šé€‰é¢˜åˆ›å»º/ç¼–è¾‘/åˆ é™¤ã€éš¾åº¦è®¾ç½®ã€æ‰¹é‡å¯¼å…¥å¯¼å‡ºï¼ˆExcel/CSVï¼‰ã€é¢˜ç›®å®¡æ ¸å‘å¸ƒ | æ’ä»¶å†…ç‹¬ç«‹å®ç°ï¼Œé¢˜ç›®æ•°æ®å­˜å‚¨åœ¨æ’ä»¶ä¸“å±è¡¨ï¼Œé€šè¿‡APIä¸åŸOJç”¨æˆ·å…³è”ï¼ˆå¤–é”®Userï¼‰          |
| 2. å¤šçº§åˆ†ç±»ç®¡ç† | åˆ†ç±»å¢åˆ æ”¹ã€æ ‘å½¢ç»“æ„ï¼ˆæ‹–æ‹½æ’åºï¼‰ã€åˆ†ç±»ä¸‹é¢˜ç›®ç»Ÿè®¡ã€æ‰¹é‡ç§»åŠ¨é¢˜ç›®             | ç”¨Django MPTTå®ç°æ ‘å½¢ç»“æ„ï¼Œåˆ†ç±»æ•°æ®å­˜å‚¨åœ¨æ’ä»¶è¡¨ï¼Œå‰ç«¯ç”¨ç‹¬ç«‹ç»„ä»¶æ¸²æŸ“åˆ†ç±»æ ‘            |
| 3. æ ‡ç­¾ç®¡ç†     | æ ‡ç­¾å¢åˆ æ”¹ã€é¢œè‰²è®¾ç½®ã€çƒ­é—¨æ ‡ç­¾ç»Ÿè®¡ã€é¢˜ç›®æ‰¹é‡æ·»åˆ æ ‡ç­¾ã€æ ‡ç­¾äº‘å±•ç¤º           | æ’ä»¶å†…å»ºTagæ¨¡å‹ï¼Œçƒ­é—¨æ ‡ç­¾ç»Ÿè®¡é€šè¿‡æ’ä»¶å†…ç¼“å­˜ï¼ˆRedisï¼‰å®ç°ï¼Œä¸ä¾èµ–åŸOJæ ‡ç­¾ç³»ç»Ÿ        |
| 4. ç­”é¢˜åŠŸèƒ½     | é¢˜ç›®åˆ—è¡¨ï¼ˆåˆ†é¡µ/ç­›é€‰/æœç´¢ï¼‰ã€ç­”é¢˜ç•Œé¢ã€å®æ—¶åˆ¤é¢˜ã€ç­”é¢˜è®°å½•ã€é¢˜ç›®æ”¶è—         | ç­”é¢˜è®°å½•å­˜å‚¨åœ¨æ’ä»¶è¡¨ï¼Œåˆ¤é¢˜é€»è¾‘åœ¨æ’ä»¶å†…å®ç°ï¼Œæ”¶è—åŠŸèƒ½å…³è”åŸOJç”¨æˆ·ä½†ä¸ä¿®æ”¹åŸç”¨æˆ·è¡¨    |
| 5. é”™é¢˜æœ¬       | è‡ªåŠ¨è®°å½•é”™é¢˜ã€åˆ†ç±»/æ ‡ç­¾/æ—¶é—´ç­›é€‰ã€é”™é¢˜ç¬”è®°ã€é‡åšç»Ÿè®¡ã€PDFå¯¼å‡ºã€ç›¸ä¼¼é¢˜æ¨è   | é”™é¢˜æ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œç›¸ä¼¼é¢˜æ¨èç®—æ³•åœ¨æ’ä»¶å†…å®ç°ï¼Œå¯¼å‡ºåŠŸèƒ½ä¸ä¾èµ–åŸOJå·¥å…·ç±»              |
| 6. ç»Ÿè®¡åˆ†æ     | ä¸ªäººç­”é¢˜ç»Ÿè®¡ã€åˆ†ç±»/æ ‡ç­¾æ­£ç¡®ç‡ã€ç­”é¢˜è¶‹åŠ¿å›¾ã€æ’è¡Œæ¦œï¼ˆæ€»æ¦œ/åˆ†ç±»æ¦œï¼‰           | ç»Ÿè®¡æ•°æ®ç¼“å­˜äºæ’ä»¶Redisé”®ï¼ˆå¸¦æ’ä»¶å‰ç¼€ï¼‰ï¼Œå›¾è¡¨ç”¨ç‹¬ç«‹EChartsç»„ä»¶ï¼Œæ’è¡Œæ¦œç‹¬ç«‹è®¡ç®—      |
| 7. æ’ä»¶ç®¡ç†     | å®‰è£…æ£€æµ‹ã€ç‰ˆæœ¬æŸ¥è¯¢ã€å¸è½½æ¸…ç†ã€å‡çº§å…¼å®¹                                     | é€šè¿‡`plugin.json`å’Œå®‰è£…è„šæœ¬å®ç°ï¼Œå¸è½½æ—¶è‡ªåŠ¨åˆ é™¤æ’ä»¶è¡¨ã€è·¯ç”±ã€èœå•æ®‹ç•™                |


## å››ã€ä»»åŠ¡æ‹†è§£ï¼ˆåˆ†é˜¶æ®µï¼šæ’ä»¶æ¶æ„â†’åŠŸèƒ½å¼€å‘â†’é›†æˆâ†’éƒ¨ç½²ï¼‰
### é˜¶æ®µ1ï¼šæ’ä»¶åŸºç¡€æ¶æ„æ­å»ºï¼ˆä¼˜å…ˆä¿éšœç‹¬ç«‹ç›®å½•ä¸å¯æ’æ‹”ï¼‰
#### 1.1 åç«¯æ’ä»¶åŸºç¡€ï¼ˆç‹¬ç«‹ç›®å½•åˆå§‹åŒ–ï¼‰
```markdown
ä»»åŠ¡1.1.1ï¼šåˆ›å»ºæ’ä»¶åç«¯ç›®å½•
- æ–°å»º `qduoj-choice-plugin/backend/` ç›®å½•ï¼Œåˆå§‹åŒ–Django Appï¼ˆå‘½åä¸º`choice_plugin`ï¼‰
- åœ¨ `choice_plugin/` ä¸‹åˆ›å»º `plugin.py`ï¼ˆæ’ä»¶å…¥å£æ–‡ä»¶ï¼‰ï¼Œå£°æ˜å…ƒä¿¡æ¯ï¼š
  ```python
  # choice_plugin/plugin.py
  PLUGIN_META = {
      "name": "qduoj-choice-question",
      "version": "1.0.0",
      "author": "xxx",
      "oj_version_require": ">=2.0.0",  # ä¾èµ–çš„OJç‰ˆæœ¬
      "description": "é’å²›OJé€‰æ‹©é¢˜åŠŸèƒ½æ’ä»¶",
      "backend_entry": "choice_plugin.apps.ChoicePluginConfig",  # Django Appå…¥å£
      "uninstall_clean": ["choice_plugin_*"],  # å¸è½½æ—¶æ¸…ç†çš„è¡¨å‰ç¼€
  }
  ```
- é…ç½® `choice_plugin/apps.py`ï¼Œä½¿ç”¨Django AppConfigå®ç°æ’ä»¶æ³¨å†Œï¼ˆä¸ä¿®æ”¹åŸOJ settingsï¼‰ï¼š
  ```python
  from django.apps import AppConfig

  class ChoicePluginConfig(AppConfig):
      default_auto_field = "django.db.models.BigAutoField"
      name = "choice_plugin"
      verbose_name = "é€‰æ‹©é¢˜æ’ä»¶"

      # æ’ä»¶å¯åŠ¨æ—¶æ‰§è¡Œï¼ˆå¦‚æ³¨å†Œä¿¡å·ã€åˆå§‹åŒ–ç¼“å­˜ï¼‰
      def ready(self):
          import choice_plugin.signals  # æ’ä»¶ä¿¡å·ï¼ˆå¦‚ç”¨æˆ·åˆ é™¤æ—¶æ¸…ç†é”™é¢˜ï¼‰
  ```
- ç¼–å†™ `backend/requirements.txt`ï¼Œå£°æ˜æ’ä»¶ä¾èµ–ï¼ˆé¿å…å†²çªï¼‰ï¼š
  ```txt
  django>=3.2,<4.0  # å¯¹é½åŸOJ Djangoç‰ˆæœ¬
  djangorestframework>=3.13.0
  django-mptt==0.14.0  # å¤šçº§åˆ†ç±»
  django-taggit==3.1.0  # æ ‡ç­¾
  openpyxl==3.1.2  # Excelå¯¼å…¥å¯¼å‡º
  ```

ä»»åŠ¡1.1.2ï¼šåç«¯ä¾èµ–ä¸æ•°æ®åº“é…ç½®
- å£°æ˜æ’ä»¶æ•°æ®åº“ç­–ç•¥ï¼š**ç‹¬ç«‹è¡¨ï¼Œä¸ä¿®æ”¹åŸOJè¡¨**ï¼Œå¤–é”®å…³è”åŸOJ Userè¡¨ï¼š
  ```python
  # choice_plugin/models/base.pyï¼ˆæ’ä»¶åŸºç¡€æ¨¡å‹ï¼Œæ‰€æœ‰æ¨¡å‹ç»§æ‰¿æ­¤ç±»ï¼‰
  from django.db import models
  from django.contrib.auth.models import User  # å…³è”åŸOJç”¨æˆ·è¡¨ï¼Œä¸ä¿®æ”¹

  class PluginBaseModel(models.Model):
      created_at = models.DateTimeField(auto_now_add=True, verbose_name="åˆ›å»ºæ—¶é—´")
      updated_at = models.DateTimeField(auto_now=True, verbose_name="æ›´æ–°æ—¶é—´")

      class Meta:
          abstract = True  # æŠ½è±¡æ¨¡å‹ï¼Œä¸ç”Ÿæˆç‹¬ç«‹è¡¨
  ```
- é…ç½®æ’ä»¶æ•°æ®åº“è¿ç§»ï¼šåœ¨ `backend/` ä¸‹ç¼–å†™ `migrate.sh`ï¼Œå®ç°å®‰è£…æ—¶è‡ªåŠ¨è¿ç§»ï¼š
  ```bash
  # backend/migrate.sh
  # åˆ‡æ¢åˆ°OJé¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰§è¡Œæ’ä»¶è¿ç§»ï¼ˆå‡è®¾OJæ ¹ç›®å½•ä¸º../qduoj/ï¼‰
  cd ../qduoj/
  python manage.py makemigrations choice_plugin --empty
  python manage.py migrate choice_plugin
  echo "æ’ä»¶æ•°æ®åº“è¿ç§»å®Œæˆ"
  ```
```

#### 1.2 å‰ç«¯æ’ä»¶åŸºç¡€ï¼ˆç‹¬ç«‹ç›®å½•ä¸å…¥å£ï¼‰
```markdown
ä»»åŠ¡1.2.1ï¼šåˆ›å»ºæ’ä»¶å‰ç«¯ç›®å½•
- æ–°å»º `qduoj-choice-plugin/frontend/` ç›®å½•ï¼Œåˆå§‹åŒ–å‰ç«¯é¡¹ç›®ï¼š
  ```bash
  cd qduoj-choice-plugin/frontend/
  npm init -y
  npm install vue@2.x vue-router@3.x axios echarts element-ui  # å¯¹é½åŸOJå‰ç«¯ç‰ˆæœ¬
  ```
- åˆ›å»º `src/plugin-entry.js`ï¼ˆå‰ç«¯æ’ä»¶å…¥å£ï¼Œä¾›OJåŠ¨æ€åŠ è½½ï¼‰ï¼š
  ```javascript
  // å‰ç«¯æ’ä»¶å…ƒä¿¡æ¯ä¸ç”Ÿå‘½å‘¨æœŸ
  export const ChoicePlugin = {
    meta: {
      name: "qduoj-choice-question",
      version: "1.0.0",
      frontendAssets: ["/plugin/choice/css/main.css", "/plugin/choice/js/main.js"],  // æ„å»ºåèµ„æºè·¯å¾„
    },
    // OJåŠ è½½æ’ä»¶æ—¶æ‰§è¡Œï¼šæ³¨å†Œè·¯ç”±ã€èœå•
    install(Vue, { router, menuService }) {
      // 1. åŠ¨æ€æ·»åŠ è·¯ç”±ï¼ˆä¸ä¿®æ”¹åŸOJ router/index.jsï¼‰
      router.addRoute("oj", {  // æŒ‚è½½åˆ°OJçš„"oj"è·¯ç”±ä¸‹
        path: "/plugin/choice/questions",
        name: "ChoiceQuestionList",
        component: () => import("./views/ChoiceList.vue"),
        meta: { title: "é€‰æ‹©é¢˜é¢˜åº“", permission: "choice:view" }  // æ’ä»¶è‡ªå®šä¹‰æƒé™
      });
      // 2. æ³¨å…¥èœå•ï¼ˆé€šè¿‡OJçš„èœå•æœåŠ¡ï¼Œä¸ä¿®æ”¹åŸOJèœå•é…ç½®ï¼‰
      menuService.addMenu({
        parentKey: "problem",  // çˆ¶èœå•ï¼šåŸOJçš„"é¢˜åº“"
        key: "choice-question",
        title: "é€‰æ‹©é¢˜",
        icon: "el-icon-edit-outline",
        path: "/plugin/choice/questions",
        permission: "choice:view"
      });
    },
    // OJå¸è½½æ’ä»¶æ—¶æ‰§è¡Œï¼šæ¸…ç†è·¯ç”±ã€èœå•
    uninstall(Vue, { router, menuService }) {
      router.removeRoute("ChoiceQuestionList");
      menuService.removeMenu("choice-question");
    }
  };

  // æš´éœ²æ’ä»¶ä¾›OJåŠ è½½
  if (window.OJPlugin) {
    window.OJPlugin.register(ChoicePlugin);
  }
  ```
- é…ç½® `vue.config.js`ï¼ŒæŒ‡å®šæ„å»ºè¾“å‡ºè·¯å¾„ï¼ˆä¾¿äºOJæŒ‚è½½æ’ä»¶èµ„æºï¼‰ï¼š
  ```javascript
  module.exports = {
    outputDir: "../dist/frontend",  // æ„å»ºåè¾“å‡ºåˆ°æ’ä»¶æ ¹ç›®å½•çš„dist
    assetsDir: "static",
    publicPath: "/plugin/choice/",  // èµ„æºè®¿é—®å‰ç¼€ï¼ˆé¿å…ä¸åŸOJå†²çªï¼‰
    configureWebpack: {
      output: {
        library: "ChoicePlugin",  // æ‰“åŒ…ä¸ºåº“ï¼Œä¾›OJåŠ¨æ€å¼•å…¥
        libraryTarget: "umd"
      }
    }
  };
  ```
```


### é˜¶æ®µ2ï¼šæ’ä»¶æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆç‹¬ç«‹å®ç°ï¼Œä¸ä¾èµ–åŸOJæ ¸å¿ƒä»£ç ï¼‰
#### 2.1 åç«¯åŠŸèƒ½å¼€å‘ï¼ˆæ’ä»¶å†…ç‹¬ç«‹å®ç°ï¼‰
```markdown
ä»»åŠ¡2.1.1ï¼šæ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆæ’ä»¶ç‹¬ç«‹è¡¨ï¼‰
- åˆ†ç±»æ¨¡å‹ï¼ˆ`choice_plugin/models/category.py`ï¼‰ï¼š
  ```python
  from django.db import models
  from mptt.models import MPTTModel, TreeForeignKey
  from .base import PluginBaseModel

  class Category(MPTTModel, PluginBaseModel):
      name = models.CharField(max_length=100, verbose_name="åˆ†ç±»åç§°")
      parent = TreeForeignKey(
          "self", null=True, blank=True, on_delete=models.CASCADE, related_name="children", verbose_name="çˆ¶åˆ†ç±»"
      )
      order = models.IntegerField(default=0, verbose_name="æ’åº")
      description = models.TextField(blank=True, verbose_name="æè¿°")
      icon = models.CharField(max_length=50, blank=True, verbose_name="å›¾æ ‡ç±»å")
      question_count = models.IntegerField(default=0, verbose_name="é¢˜ç›®æ•°é‡")

      class MPTTMeta:
          order_insertion_by = ["order"]
          verbose_name = "é€‰æ‹©é¢˜åˆ†ç±»"
          verbose_name_plural = "é€‰æ‹©é¢˜åˆ†ç±»"

      class Meta:
          db_table = "choice_plugin_category"  # è¡¨åå¸¦æ’ä»¶å‰ç¼€ï¼Œé¿å…å†²çª
  ```
- é¢˜ç›®æ¨¡å‹ï¼ˆ`choice_plugin/models/question.py`ï¼‰ã€é”™é¢˜æœ¬æ¨¡å‹ï¼ˆ`choice_plugin/models/wrong_book.py`ï¼‰åŒç†ï¼Œå‡ç»§æ‰¿`PluginBaseModel`ï¼Œè¡¨åå¸¦`choice_plugin_`å‰ç¼€ã€‚

ä»»åŠ¡2.1.2ï¼šæ’ä»¶APIå¼€å‘ï¼ˆå¸¦æ’ä»¶å‰ç¼€ï¼Œé¿å…å†²çªï¼‰
- åœ¨ `choice_plugin/api/urls.py` ä¸­å®šä¹‰æ’ä»¶APIè·¯ç”±ï¼š
  ```python
  from django.urls import path
  from .views import CategoryViewSet, QuestionViewSet

  urlpatterns = [
      path("categories/", CategoryViewSet.as_view({"get": "list", "post": "create"}), name="choice-category"),
      path("questions/", QuestionViewSet.as_view({"get": "list", "post": "create"}), name="choice-question"),
      # å…¶ä»–API...
  ]
  ```
- åœ¨ `choice_plugin/plugin.py` ä¸­å£°æ˜APIæŒ‚è½½ç‚¹ï¼ˆä¾›OJåŠ¨æ€æ·»åŠ ï¼‰ï¼š
  ```python
  PLUGIN_META["api_urls"] = {
      "prefix": "/api/plugin/choice/",  # APIå‰ç¼€ï¼Œé¿å…ä¸åŸOJå†²çª
      "urls_module": "choice_plugin.api.urls"
  }
  ```
- APIè§†å›¾å®ç°ï¼ˆ`choice_plugin/api/views.py`ï¼‰ï¼šå¤ç”¨DRFï¼Œä½†æƒé™åˆ¤æ–­å…³è”åŸOJç”¨æˆ·ï¼ˆå¦‚ç®¡ç†å‘˜æƒé™é€šè¿‡`request.user.is_staff`åˆ¤æ–­ï¼‰ã€‚
```

#### 2.2 å‰ç«¯åŠŸèƒ½å¼€å‘ï¼ˆç‹¬ç«‹ç»„ä»¶ï¼Œå¤ç”¨OJæ ·å¼ï¼‰
```markdown
ä»»åŠ¡2.2.1ï¼šæ ¸å¿ƒé¡µé¢å¼€å‘ï¼ˆç‹¬ç«‹ç»„ä»¶ï¼Œä¸ä¾èµ–åŸOJç»„ä»¶ç›®å½•ï¼‰
- é¢˜ç›®åˆ—è¡¨é¡µï¼ˆ`src/views/ChoiceList.vue`ï¼‰ï¼šå¤ç”¨åŸOJçš„Element UIç»„ä»¶ï¼Œä½†é€šè¿‡ç‹¬ç«‹APIè¯·æ±‚æ•°æ®ï¼š
  ```vue
  <template>
    <div class="choice-list-page">
      <!-- å¤ç”¨åŸOJçš„Panelç»„ä»¶ï¼Œä¿æŒUIä¸€è‡´ -->
      <el-panel title="é€‰æ‹©é¢˜é¢˜åº“">
        <!-- ç­›é€‰åŒºï¼šåˆ†ç±»+æ ‡ç­¾ -->
        <el-row :gutter="10">
          <el-col :span="8">
            <category-tree v-model="selectedCategory" />  <!-- æ’ä»¶å†…ç»„ä»¶ -->
          </el-col>
          <el-col :span="8">
            <tag-select v-model="selectedTags" />  <!-- æ’ä»¶å†…ç»„ä»¶ -->
          </el-col>
        </el-row>
        <!-- é¢˜ç›®è¡¨æ ¼ -->
        <el-table :data="questionList" border>
          <el-table-column label="é¢˜ç›®" prop="title" />
          <el-table-column label="éš¾åº¦" prop="difficulty" />
          <el-table-column label="æ“ä½œ">
            <template #default="scope">
              <el-button @click="goToDetail(scope.row.id)">æŸ¥çœ‹</el-button>
            </template>
          </el-table-column>
        </el-table>
      </el-panel>
    </div>
  </template>

  <script>
  import { getQuestionList } from "@/api/choice-api";  // æ’ä»¶å†…APIå°è£…
  import CategoryTree from "@/components/CategoryTree.vue";  // æ’ä»¶å†…ç»„ä»¶
  export default {
    data() {
      return { questionList: [], selectedCategory: null, selectedTags: [] };
    },
    methods: {
      async fetchQuestions() {
        const res = await getQuestionList({ category: this.selectedCategory, tags: this.selectedTags });
        this.questionList = res.data;
      }
    }
  };
  </script>
  ```
- é”™é¢˜æœ¬é¡µé¢ï¼ˆ`src/views/WrongBook.vue`ï¼‰ã€ç­”é¢˜è¯¦æƒ…é¡µåŒç†ï¼Œå‡ä½¿ç”¨æ’ä»¶å†…ç»„ä»¶å’ŒAPIã€‚

ä»»åŠ¡2.2.2ï¼šå‰ç«¯çŠ¶æ€ç®¡ç†ï¼ˆç‹¬ç«‹Vuexæ¨¡å—ï¼Œä¸æ±¡æŸ“åŸOJï¼‰
- åˆ›å»º `src/store/choice-store.js`ï¼š
  ```javascript
  const state = { wrongCount: 0 };
  const mutations = {
    SET_WRONG_COUNT(state, count) { state.wrongCount = count; }
  };
  const actions = {
    fetchWrongCount({ commit }, userId) {
      // è°ƒç”¨æ’ä»¶APIè·å–é”™é¢˜æ•°
      return axios.get("/api/plugin/choice/wrong-count/", { params: { user_id: userId } })
        .then(res => commit("SET_WRONG_COUNT", res.data.count));
    }
  };
  export default { namespaced: true, state, mutations, actions };  // å¸¦å‘½åç©ºé—´ï¼Œé¿å…å†²çª
  ```
- åœ¨ `plugin-entry.js` ä¸­åŠ¨æ€æ³¨å†Œåˆ°åŸOJçš„Vuexï¼š
  ```javascript
  install(Vue, { store }) {
    store.registerModule("choicePlugin", import("./store/choice-store.js"));  // æ³¨å†Œå‘½åç©ºé—´æ¨¡å—
  }
  ```
```


### é˜¶æ®µ3ï¼šæ’ä»¶ä¸OJé›†æˆï¼ˆåŠ¨æ€æŒ‚è½½ï¼Œä¸ä¿®æ”¹åŸOJæ ¸å¿ƒï¼‰
```markdown
ä»»åŠ¡3.1ï¼šåç«¯é›†æˆï¼ˆé€šè¿‡OJæ’ä»¶æ¥å£æˆ–è„šæœ¬åŠ¨æ€æ³¨å†Œï¼‰
- è‹¥åŸOJæœ‰æ’ä»¶æ³¨å†Œæœºåˆ¶ï¼šåœ¨OJåå°â€œæ’ä»¶ç®¡ç†â€ä¸Šä¼ `plugin.json`ï¼ŒOJè‡ªåŠ¨åŠ è½½`backend_entry`ï¼ˆDjango Appï¼‰å’Œ`api_urls`ï¼›
- è‹¥OJæ— æ’ä»¶æœºåˆ¶ï¼šæä¾› `install_backend.sh` è„šæœ¬ï¼Œé€šè¿‡Djangoå‘½ä»¤åŠ¨æ€æ·»åŠ Appå’ŒAPIï¼š
  ```bash
  # install_backend.sh
  # 1. å°†æ’ä»¶åç«¯ç›®å½•é“¾æ¥åˆ°OJçš„appsç›®å½•ï¼ˆé¿å…å¤åˆ¶ï¼‰
  ln -s $(pwd)/backend/choice_plugin ../qduoj/apps/
  # 2. åŠ¨æ€æ·»åŠ Appåˆ°OJçš„settings.pyï¼ˆé€šè¿‡sedå‘½ä»¤ï¼Œå¸è½½æ—¶åå‘åˆ é™¤ï¼‰
  sed -i '/INSTALLED_APPS/a \    "apps.choice_plugin",' ../qduoj/conf/settings.py
  # 3. åŠ¨æ€æ·»åŠ APIè·¯ç”±åˆ°OJçš„ä¸»urls.py
  sed -i '/urlpatterns/a \path("api/plugin/choice/", include("apps.choice_plugin.api.urls")),\' ../qduoj/conf/urls.py
  # 4. æ‰§è¡Œæ•°æ®åº“è¿ç§»
  cd ../qduoj/ && python manage.py migrate choice_plugin
  ```

ä»»åŠ¡3.2ï¼šå‰ç«¯é›†æˆï¼ˆåŠ¨æ€åŠ è½½èµ„æºä¸è·¯ç”±ï¼‰
- æ„å»ºå‰ç«¯èµ„æºï¼š
  ```bash
  cd frontend/ && npm run build  # è¾“å‡ºåˆ° ../dist/frontend/
  ```
- å°†æ„å»ºåçš„èµ„æºæŒ‚è½½åˆ°OJçš„é™æ€ç›®å½•ï¼š
  ```bash
  # install_frontend.sh
  # 1. å¤åˆ¶å‰ç«¯èµ„æºåˆ°OJçš„static/plugin/choice/
  cp -r ../dist/frontend/static/* ../qduoj/static/plugin/choice/
  # 2. åœ¨OJçš„index.htmlä¸­åŠ¨æ€å¼•å…¥æ’ä»¶å…¥å£ï¼ˆå¸è½½æ—¶åˆ é™¤ï¼‰
  sed -i '</body>/i \    <script src="/static/plugin/choice/js/main.js"></script>' ../qduoj/templates/index.html
  ```
```


### é˜¶æ®µ4ï¼šæ’ä»¶å®‰è£…/å¸è½½/å‡çº§ï¼ˆå®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼‰
```markdown
ä»»åŠ¡4.1ï¼šä¸€é”®å®‰è£…è„šæœ¬ï¼ˆ`install.sh`ï¼‰
```bash
#!/bin/bash
# æ’ä»¶ä¸€é”®å®‰è£…è„šæœ¬
echo "å¼€å§‹å®‰è£…é€‰æ‹©é¢˜æ’ä»¶..."

# 1. å®‰è£…åç«¯ä¾èµ–
cd backend/ && pip install -r requirements.txt
# 2. æ‰§è¡Œåç«¯é›†æˆ
./install_backend.sh
# 3. æ„å»ºå¹¶é›†æˆå‰ç«¯
cd ../frontend/ && npm install && npm run build
../install_frontend.sh

echo "æ’ä»¶å®‰è£…å®Œæˆï¼è®¿é—®OJçš„ã€Œé¢˜åº“â†’é€‰æ‹©é¢˜ã€å³å¯ä½¿ç”¨"
```

ä»»åŠ¡4.2ï¼šä¸€é”®å¸è½½è„šæœ¬ï¼ˆ`uninstall.sh`ï¼‰
```bash
#!/bin/bash
# æ’ä»¶ä¸€é”®å¸è½½è„šæœ¬
echo "å¼€å§‹å¸è½½é€‰æ‹©é¢˜æ’ä»¶..."

# 1. æ¸…ç†åç«¯
cd backend/ && ./uninstall_backend.sh  # åå‘æ‰§è¡Œinstall_backend.shçš„æ“ä½œ
# 2. æ¸…ç†å‰ç«¯èµ„æº
rm -rf ../qduoj/static/plugin/choice/
sed -i '/static\/plugin\/choice\/js\/main.js/d' ../qduoj/templates/index.html
# 3. æ¸…ç†æ•°æ®åº“è¡¨ï¼ˆæ ¹æ®plugin.jsonçš„uninstall_cleanï¼‰
cd ../qduoj/ && python manage.py dbshell -c "DROP TABLE IF EXISTS choice_plugin_category, choice_plugin_question, choice_plugin_wrongbook;"

echo "æ’ä»¶å¸è½½å®Œæˆï¼"
```

ä»»åŠ¡4.3ï¼šç‰ˆæœ¬å‡çº§è„šæœ¬ï¼ˆ`upgrade.sh`ï¼‰
```bash
#!/bin/bash
# æ’ä»¶å‡çº§è„šæœ¬
echo "å¼€å§‹å‡çº§é€‰æ‹©é¢˜æ’ä»¶..."

# 1. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå‡è®¾ç”¨Gitï¼‰
git pull
# 2. å‡çº§åç«¯ä¾èµ–
cd backend/ && pip install -r requirements.txt --upgrade
# 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¤„ç†ç‰ˆæœ¬å·®å¼‚ï¼‰
cd ../qduoj/ && python manage.py migrate choice_plugin
# 4. é‡æ„å‰ç«¯
cd ../frontend/ && npm install && npm run build
# 5. åˆ·æ–°é™æ€èµ„æº
cp -r ../dist/frontend/static/* ../qduoj/static/plugin/choice/

echo "æ’ä»¶å‡çº§å®Œæˆï¼å½“å‰ç‰ˆæœ¬ï¼š$(cat plugin.json | jq -r '.version')"
```
```


## äº”ã€è°ƒç ”ä»»åŠ¡è¡¥å……ï¼ˆæ’ä»¶åŒ–ç›¸å…³ï¼Œäº¤ç»™Traeï¼‰
åœ¨åŸæœ‰è°ƒç ”åŸºç¡€ä¸Šï¼Œå¢åŠ **æ’ä»¶é›†æˆå…³é”®ä¿¡æ¯**è°ƒç ”ï¼Œé¿å…é›†æˆæ—¶è¸©å‘ï¼š
1. **åŸOJçš„æ’ä»¶æ”¯æŒæƒ…å†µ**ï¼š
   - OJæ˜¯å¦æœ‰å®˜æ–¹æ’ä»¶æ³¨å†Œæœºåˆ¶ï¼ˆå¦‚`plugins/`ç›®å½•ã€`PluginManager`ç±»ï¼‰ï¼Ÿ
   - OJçš„`settings.py`æ˜¯å¦æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶å¼•å…¥å¤–éƒ¨Appï¼Ÿ
   - OJçš„ä¸»`urls.py`æ˜¯å¦æœ‰åŠ¨æ€è·¯ç”±æ³¨å†Œæ¥å£ï¼ˆå¦‚`register_url_prefix`å‡½æ•°ï¼‰ï¼Ÿ
2. **å‰ç«¯åŠ¨æ€é›†æˆèƒ½åŠ›**ï¼š
   - OJçš„Vueå®ä¾‹æ˜¯å¦æš´éœ²å…¨å±€æŒ‚è½½ç‚¹ï¼ˆå¦‚`window.OJ`ï¼‰ï¼Ÿ
   - OJçš„èœå•ç³»ç»Ÿæ˜¯å¦æ”¯æŒé€šè¿‡APIæ³¨å…¥èœå•ï¼ˆå¦‚`menuService.add`ï¼‰ï¼Ÿ
   - OJçš„Vuexæ˜¯å¦å…è®¸æ³¨å†Œå‘½åç©ºé—´æ¨¡å—ï¼ˆé¿å…å†²çªï¼‰ï¼Ÿ
3. **æ•°æ®æƒé™ä¸å®‰å…¨**ï¼š
   - OJçš„ç”¨æˆ·è®¤è¯Tokenæ˜¯å¦åœ¨æ‰€æœ‰è¯·æ±‚å¤´ä¸­æºå¸¦ï¼ˆæ’ä»¶APIéœ€å¤ç”¨ï¼‰ï¼Ÿ
   - OJæ˜¯å¦æœ‰è‡ªå®šä¹‰æƒé™è£…é¥°å™¨ï¼ˆå¦‚`@login_required`ã€`@admin_required`ï¼‰ï¼Œæ’ä»¶èƒ½å¦ç›´æ¥ä½¿ç”¨ï¼Ÿ
4. **é™æ€èµ„æºä¸æ„å»º**ï¼š
   - OJçš„é™æ€æ–‡ä»¶è®¿é—®è·¯å¾„è§„åˆ™ï¼ˆå¦‚æ˜¯å¦éœ€è¦`STATIC_URL`å‰ç¼€ï¼‰ï¼Ÿ
   - OJçš„å‰ç«¯æ„å»ºå·¥å…·ï¼ˆå¦‚Webpackï¼‰æ˜¯å¦ä¸æ’ä»¶å…¼å®¹ï¼ˆç‰ˆæœ¬ã€é…ç½®ï¼‰ï¼Ÿ


## å…­ã€éªŒè¯è¦ç‚¹ï¼ˆæ–°å¢æ’ä»¶åŒ–ç‰¹æ€§æ£€æŸ¥ï¼‰
| éªŒè¯æ¨¡å—       | æ£€æŸ¥é¡¹                                                                 |
|----------------|-----------------------------------------------------------------------|
| æ’ä»¶ç‹¬ç«‹æ€§     | 1. æ’ä»¶ç›®å½•æ˜¯å¦å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¿®æ”¹åŸOJæ ¸å¿ƒæ–‡ä»¶ï¼Ÿ<br>2. å¸è½½ååŸOJåŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œæ— æ®‹ç•™æ•°æ®ï¼Ÿ |
| å¯æ’æ‹”æ€§       | 1. æ‰§è¡Œ`install.sh`èƒ½å¦ä¸€é”®å®‰è£…æˆåŠŸï¼Ÿ<br>2. æ‰§è¡Œ`uninstall.sh`èƒ½å¦å®Œå…¨æ¸…ç†ï¼Ÿ          |
| åŠŸèƒ½å®Œæ•´æ€§     | 1. æ‰€æœ‰é€‰æ‹©é¢˜åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼ˆåˆ†ç±»ã€ç­”é¢˜ã€é”™é¢˜æœ¬ï¼‰ï¼Ÿ<br>2. æ•°æ®ç»Ÿè®¡æ˜¯å¦ä¸åŸOJç”¨æˆ·å…³è”ï¼Ÿ    |
| å…¼å®¹æ€§         | 1. æ’ä»¶ç‰ˆæœ¬ä¸OJç‰ˆæœ¬æ˜¯å¦åŒ¹é…ï¼ˆå¦‚Django/Vueç‰ˆæœ¬ï¼‰ï¼Ÿ<br>2. æ’ä»¶APIæ˜¯å¦ä¸åŸOJæ¥å£æ— å†²çªï¼Ÿ  |


## ä¸ƒã€ä½¿ç”¨å»ºè®®
1. **å¼€å‘é¡ºåº**ï¼šå…ˆå®Œæˆâ€œæ’ä»¶åŸºç¡€æ¶æ„â€ï¼ˆé˜¶æ®µ1ï¼‰ï¼Œç¡®ä¿ç›®å½•ç‹¬ç«‹ã€å¯æŒ‚è½½åï¼Œå†å¼€å‘æ ¸å¿ƒåŠŸèƒ½ï¼ˆé˜¶æ®µ2ï¼‰ï¼Œé¿å…åæœŸé‡æ„ï¼›
2. **æµ‹è¯•ä¼˜å…ˆçº§**ï¼šä¼˜å…ˆæµ‹è¯•â€œå¸è½½åŠŸèƒ½â€ï¼Œç¡®ä¿æ’ä»¶ä¸ä¼šç ´ååŸOJç³»ç»Ÿï¼›
3. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ¯æ¬¡è¿­ä»£æ›´æ–°`plugin.json`çš„ç‰ˆæœ¬å·ï¼Œå‡çº§è„šæœ¬é€šè¿‡ç‰ˆæœ¬å·åˆ¤æ–­æ˜¯å¦éœ€è¦è¿ç§»æ•°æ®ï¼›
4. **æ–‡æ¡£åŒæ­¥**ï¼šåœ¨æ’ä»¶æ ¹ç›®å½•ä¸‹ä¿ç•™`README.md`ï¼Œè¯´æ˜å®‰è£…æ­¥éª¤ã€åŠŸèƒ½æ¸…å•ã€å¸¸è§é—®é¢˜ï¼Œä¾¿äºå…¶ä»–ç”¨æˆ·ä½¿ç”¨ã€‚