# 选择题批量导入功能使用指南

## 概述

本目录包含了选择题批量导入功能的所有相关文件，以及用于诊断和修复导入格式问题的工具。

## 文件说明

### 核心功能文件
- `choice_question/` - 选择题应用的完整代码
- `utils/` - 工具类和API基础设施
- `account/` - 用户认证和权限管理
- `oj/` - Django项目配置
- `manage.py` - Django管理脚本

### 测试和诊断工具
- `diagnose_import.py` - 导入格式诊断工具（推荐使用）
- `test_import.py` - 导入功能测试脚本
- `import_example.json` - 正确格式示例
- `import_error_example.json` - 错误格式示例
- `README.md` - 详细技术文档

## 快速开始

### 1. 诊断导入文件

如果您的导入提示格式不正确，请使用诊断工具：

```bash
python3 diagnose_import.py 您的导入文件.json
```

示例：
```bash
# 测试正确格式
python3 diagnose_import.py import_example.json

# 测试错误格式
python3 diagnose_import.py import_error_example.json
```

### 2. 查看标准格式

参考 `import_example.json` 文件，标准格式如下：

```json
{
  "questions": [
    {
      "question": "题目内容",
      "type": "single",
      "options": ["选项A", "选项B", "选项C", "选项D"],
      "correct": "A",
      "explanation": "解析说明（可选）"
    }
  ],
  "category_id": 1
}
```

## 常见问题及解决方案

### 问题1：JSON格式错误
**症状**：提示JSON格式错误
**解决方案**：
- 检查所有的花括号 `{}` 和方括号 `[]` 是否配对
- 确保所有字符串都用双引号包围
- 检查逗号是否正确使用（最后一个元素后不要加逗号）

### 问题2：缺少必填字段
**症状**：提示缺少 question、type、options 或 correct 字段
**解决方案**：
- 确保每个题目都包含所有必填字段
- 检查字段名是否拼写正确

### 问题3：题目类型错误
**症状**：提示题目类型无效
**解决方案**：
- `type` 字段只能是 `"single"` 或 `"multiple"`
- 注意使用双引号，且全部小写

### 问题4：选项数量不足
**症状**：提示选项至少需要2个
**解决方案**：
- 确保 `options` 数组至少包含2个选项
- 检查选项内容不能为空

### 问题5：正确答案格式错误
**症状**：提示答案格式错误或超出范围
**解决方案**：
- 使用大写字母 A、B、C、D 等表示答案
- 多选题用逗号分隔：`"A,C"`
- 确保答案在选项范围内（如有4个选项，答案只能是A-D）

### 问题6：单选题多个答案
**症状**：提示单选题只能有一个答案
**解决方案**：
- 将 `type` 改为 `"multiple"`，或
- 只保留一个正确答案

## 使用流程

### 步骤1：准备数据
1. 按照标准格式准备JSON文件
2. 使用诊断工具检查格式：`python3 diagnose_import.py 您的文件.json`
3. 根据诊断结果修复问题

### 步骤2：导入数据
1. 登录系统（需要超级管理员权限）
2. 访问导入页面：`http://localhost:8080/admin/choice-question/import`
3. 上传或粘贴JSON数据
4. 点击导入按钮

### 步骤3：检查结果
- 查看导入成功的题目数量
- 检查错误信息列表
- 根据错误信息修复问题后重新导入

## 技术支持

### 运行测试
```bash
# 运行完整测试
python3 test_import.py
```

### 查看详细文档
- 阅读 `README.md` 了解技术细节
- 查看 `choice_question/` 目录了解代码结构

### 联系开发者
如果遇到无法解决的问题，请提供：
1. 错误信息截图
2. 导入的JSON文件内容
3. 诊断工具的输出结果

## 注意事项

1. **权限要求**：导入功能需要超级管理员权限
2. **数据备份**：导入前建议备份现有数据
3. **批量限制**：建议单次导入不超过100道题目
4. **字符编码**：确保文件使用UTF-8编码
5. **特殊字符**：题目内容支持HTML标签，但要注意转义

## 更新日志

- 2024-01-XX：添加诊断工具和使用指南
- 2024-01-XX：修复题目验证逻辑
- 2024-01-XX：优化导入错误提示