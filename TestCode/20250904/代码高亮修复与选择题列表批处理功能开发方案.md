1、http://localhost:8081/admin/choice-question/import
导入时候选择了编程语言 C++，但是前端没有按照C++渲染，实现代码高亮，在后台编辑修改时候发现，选择题里的C++代码在编辑框中没有指定具体编程语言，如何修复这个问题？
2、http://localhost:8081/admin/choice-questions
要在选择题列表中增加批处理功能，如何开发？
### 问题1：代码高亮及编程语言指定问题修复


#### 问题分析
导入时选择的编程语言（如C++）未被正确应用到代码渲染和编辑框中，核心原因是：
1. 前端渲染代码时未使用存储的`language`字段指定高亮类型
2. 编辑界面未读取保存的`language`值来预设编辑器语言


#### 修复方案

##### 1. 确保后端正确存储`language`字段
检查选择题模型（`ChoiceQuestion`）是否包含`language`字段，若未添加需补充：
```python
# models.py
class ChoiceQuestion(models.Model):
    # 已有字段...
    language = models.CharField(max_length=20, default="text", verbose_name="代码语言")
    # 其他字段...
```


##### 2. 前端代码渲染时指定语言
在题目展示和编辑组件中，使用存储的`language`字段初始化代码高亮：

```vue
<!-- 题目展示组件 (如ChoiceQuestionDetail.vue) -->
<template>
  <div class="question-content">
    <!-- 其他内容... -->
    <pre v-if="question.code"><code :class="`language-${question.language}`">{{ question.code }}</code></pre>
  </div>
</template>

<script>
import hljs from 'highlight.js'
import 'highlight.js/styles/github.css'

export default {
  // ...
  mounted() {
    // 初始化代码高亮
    document.querySelectorAll('pre code').forEach(block => {
      hljs.highlightElement(block)
    })
  }
}
</script>
```


##### 3. 编辑框预设编程语言
在编辑组件（如ChoiceQuestion.vue）中，读取`language`字段设置编辑器语言：

```vue
<!-- 编辑组件 -->
<template>
  <el-form>
    <!-- 其他表单项... -->
    <el-form-item label="代码语言">
      <el-select v-model="form.language" placeholder="选择编程语言">
        <el-option value="text" label="Plain Text"></el-option>
        <el-option value="cpp" label="C++"></el-option>
        <!-- 其他语言选项... -->
      </el-select>
    </el-form-item>
    <el-form-item label="代码内容">
      <codemirror 
        v-model="form.code" 
        :mode="form.language"  <!-- 使用存储的language -->
        :options="editorOptions"
      ></codemirror>
    </el-form-item>
  </el-form>
</template>

<script>
export default {
  data() {
    return {
      form: {
        language: 'text',  // 默认值
        code: '',
        // 其他字段...
      },
      editorOptions: {
        lineNumbers: true,
        // 其他配置...
      }
    }
  },
  created() {
    // 编辑时加载已有数据，包括language
    if (this.isEdit) {
      this.$http.get(`/api/admin/choice_question/${this.id}`).then(res => {
        this.form = { ...res.data, language: res.data.language || 'text' }
      })
    }
  }
}
</script>
```


### 问题2：选择题列表批处理功能开发


#### 功能设计
支持批量删除、批量修改难度、批量设置公开状态等操作，实现步骤如下：


##### 1. 前端列表添加复选框选择
在`ChoiceQuestionList.vue`的表格中添加复选框列：

```vue
<template>
  <el-table 
    :data="tableData" 
    border 
    @selection-change="handleSelectionChange"  <!-- 监听选择变化 -->
  >
    <!-- 复选框列 -->
    <el-table-column type="selection" width="55"></el-table-column>
    
    <!-- 其他列... -->
    <el-table-column label="操作">
      <!-- 现有操作按钮... -->
    </el-table-column>
  </el-table>

  <!-- 批处理操作按钮 -->
  <div class="batch-operations" v-if="selectedIds.length > 0">
    <el-dropdown @command="handleBatchCommand">
      <el-button type="primary">
        批量操作 <i class="el-icon-arrow-down el-icon--right"></i>
      </el-button>
      <el-dropdown-menu>
        <el-dropdown-item command="delete">删除所选</el-dropdown-item>
        <el-dropdown-item command="set_public">设为公开</el-dropdown-item>
        <el-dropdown-item command="set_private">设为私有</el-dropdown-item>
        <el-dropdown-item command="set_difficulty_easy">难度设为简单</el-dropdown-item>
        <!-- 其他操作... -->
      </el-dropdown-menu>
    </el-dropdown>
  </div>
</template>

<script>
export default {
  data() {
    return {
      selectedIds: [],  // 存储选中的题目ID
      // 其他数据...
    }
  },
  methods: {
    // 监听选择变化
    handleSelectionChange(selection) {
      this.selectedIds = selection.map(item => item.id)
    },
    // 处理批处理命令
    handleBatchCommand(command) {
      if (this.selectedIds.length === 0) {
        this.$message.warning("请先选择题目")
        return
      }

      switch(command) {
        case 'delete':
          this.batchDelete()
          break
        case 'set_public':
          this.batchUpdate({ is_public: true })
          break
        case 'set_private':
          this.batchUpdate({ is_public: false })
          break
        case 'set_difficulty_easy':
          this.batchUpdate({ difficulty: 'easy' })
          break
        // 其他操作...
      }
    },
    // 批量删除
    batchDelete() {
      this.$confirm(`确定删除选中的${this.selectedIds.length}道题目?`, '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        this.$http.post('/api/admin/choice_question/batch', {
          action: 'delete',
          question_ids: this.selectedIds
        }).then(res => {
          this.$message.success('删除成功')
          this.getChoiceQuestionList(1)  // 刷新列表
          this.selectedIds = []  // 清空选择
        })
      })
    },
    // 批量更新状态/属性
    batchUpdate(params) {
      this.$http.post('/api/admin/choice_question/batch', {
        action: 'update',
        question_ids: this.selectedIds,
        params: params
      }).then(res => {
        this.$message.success('操作成功')
        this.getChoiceQuestionList(1)
        this.selectedIds = []
      })
    }
  }
}
</script>
```


##### 2. 后端批量操作接口实现
复用现有`BatchOperationAPI`并扩展功能（参考`qduoj-choice-question-plugin/backend/choice_question/api/import_export.py`）：

```python
# 扩展BatchOperationAPI
class BatchOperationAPI(BaseAPIView):
    @login_required
    def post(self, request):
        action = request.data.get('action')
        question_ids = request.data.get('question_ids', [])
        params = request.data.get('params', {})  # 新增：接收更新参数

        if not action or not question_ids:
            return error_response("参数不完整")

        queryset = ChoiceQuestion.objects.filter(id__in=question_ids)
        # 权限检查
        if not request.user.is_admin_role():
            queryset = queryset.filter(created_by=request.user)

        affected_count = queryset.count()
        if affected_count == 0:
            return error_response("没有找到可操作的题目")

        try:
            if action == 'delete':
                queryset.delete()
            elif action == 'set_public':
                queryset.update(is_public=True)
            elif action == 'set_private':
                queryset.update(is_public=False)
            elif action == 'update':  # 新增：支持批量更新任意字段
                queryset.update(**params)
            # 其他操作...
            else:
                return error_response("不支持的操作类型")

            return success_response({
                'affected_count': affected_count,
                'message': f'成功{action} {affected_count} 道题目'
            })
        except Exception as e:
            return error_response(f"批量操作失败: {str(e)}")
```


##### 3. 权限控制与反馈优化
- 仅管理员可见批处理按钮（通过`v-if="user.is_admin"`控制）
- 操作成功/失败后显示明确提示，并自动刷新列表
- 批量操作时添加加载状态（`loading`变量）防止重复提交


### 总结
1. 代码高亮问题：通过绑定`language`字段到渲染组件和编辑器，确保前后端数据一致
2. 批处理功能：前端添加复选框选择和操作菜单，后端扩展批量接口支持多类型操作，注意权限控制和用户反馈
